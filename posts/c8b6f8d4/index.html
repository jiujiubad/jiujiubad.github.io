<!DOCTYPE HTML>
<html>
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>ror-function-搜索(大数据量)如elastic：gem searchkick | Hexo</title>


    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
    <div class="hide">
    	<script src="https://s4.cnzz.com/z_stat.php?id=1263868967&web_id=1263868967" language="JavaScript"></script>
    </div>






    
</head>

<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
  <div class="container-fluid">
    <div class="row">
      <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner2.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="">
            <img src="/img/avatar.jpg" alt="logo头像">
        </a>
        <div class="branding1">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2 style="color:#ddd;letter-spacing:1.5px;"> 不忘积累，记录点滴 by 99 </h2>
            
    	</div>
    </div>
</header>

      <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation"><a href="/"><i class="fa fa-fw "></i>Home</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/前端/"><i class="fa fa-fw "></i>前端</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/后端/"><i class="fa fa-fw "></i>后端</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/工具/"><i class="fa fa-fw "></i>工具</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/资源/"><i class="fa fa-fw "></i>资源</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
      <section class="content-wra aa99">
        <div class="row">
          
    <div class="widget" style="padding:0 15px;">
        <div id="search-form" >
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?" style="width:100%;border-radius:0;">

                
                
            </div>
            <div id="result-wrap" class="hide" style="padding:0 20px;">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>


        </div>
        <div class="row">
            <main class="col-md-9 main-content m-post">
                <p id="process"></p>
<article class="post pp99">
    <div class="post-head">
        <h1 id="ror-function-搜索(大数据量)如elastic：gem searchkick">
            
	            ror-function-搜索(大数据量)如elastic：gem searchkick
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <span>ror功能</span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            ror功能
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2018/01/10</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h1 id="一、参考资料"><a href="#一、参考资料" class="headerlink" title="一、参考资料"></a>一、参考资料</h1><h2 id="1、用gem-elasticsearch-rails还是searchkick？"><a href="#1、用gem-elasticsearch-rails还是searchkick？" class="headerlink" title="1、用gem elasticsearch-rails还是searchkick？"></a>1、用gem elasticsearch-rails还是searchkick？</h2><p>1）searchkick有更多的基于个人用户的定制，<a href="https://github.com/elastic/elasticsearch-rails" target="_blank" rel="noopener">gem elasticsearch-rails</a>只是ElasticSearch团队的一个语言库。<a href="https://stackoverflow.com/questions/26210175/what-is-the-difference-between-searchkick-and-elasticsearch-rails" target="_blank" rel="noopener">参考资料点击</a>。</p>
<h2 id="2、Ruby-on-rails-实战圣经"><a href="#2、Ruby-on-rails-实战圣经" class="headerlink" title="2、Ruby on rails 实战圣经"></a>2、Ruby on rails 实战圣经</h2><p><em>ActiveReord</em>: 加强搜寻</p>
<ul>
<li><a href="https://github.com/activerecord-hackery/ransack" target="_blank" rel="noopener">Ransack</a>可以很快的针对<em>ActiveRecord</em>做出排序和复杂的条件搜寻。不过 ransack 并不太考虑效能问题，特别是文字模糊搜寻，这部份网站长大后会改用全文搜寻引擎，例如 <a href="https://www.elastic.co/" target="_blank" rel="noopener">ElasticSearch</a></li>
</ul>
<h2 id="3、Ruby-on-rails-实战圣经"><a href="#3、Ruby-on-rails-实战圣经" class="headerlink" title="3、Ruby on rails 实战圣经"></a>3、Ruby on rails 实战圣经</h2><p><a href="https://ihower.tw/rails/performance-cn.html" target="_blank" rel="noopener">全文搜尋<em>Full-text search engine</em></a></p>
<p>如果需要搜尋<em>text</em>欄位，因為資料庫沒辦法加索引，所以會造成<em>table scan</em>把資料表所有資料都掃描一次，效能會非常低落。這時候可以使用外部的全文搜尋伺服器來做索引，目前常見有以下選擇：</p>
<ul>
<li><em>Elasticsearch</em>全文搜尋引擎和<em>elasticsearch-rails gem</em></li>
<li><em>Apache Solr(Lucenel)</em>全文搜尋引擎和<em>Sunspot gem</em></li>
<li><em>PostgreSQL</em>內建有全文搜尋功能，可以搭配 <em>texticle gem</em>或 <em>pg_search gem</em></li>
<li><em>Sphinx</em>全文搜尋引擎和<em>thinking_sphinx gem</em></li>
</ul>
<h1 id="二、搜索gem选哪个？"><a href="#二、搜索gem选哪个？" class="headerlink" title="二、搜索gem选哪个？"></a>二、搜索gem选哪个？</h1><h2 id="1、结论"><a href="#1、结论" class="headerlink" title="1、结论"></a>1、结论</h2><p>1）效能要求较低，一万笔以内的数据，用<a href="https://github.com/activerecord-hackery/ransack" target="_blank" rel="noopener">gem ransack</a>；</p>
<p>2）几万笔属于，用elasticsearch，其中最好用的是<a href="https://github.com/ankane/searchkick" target="_blank" rel="noopener">gem searchkick</a>；</p>
<blockquote>
<p>searchkick建立在<a href="https://github.com/elastic/elasticsearch-ruby/tree/master/elasticsearch-transport" target="_blank" rel="noopener">elasticsearch-transport</a>和<a href="https://github.com/elastic/elasticsearch-ruby/tree/master/elasticsearch-api" target="_blank" rel="noopener">elasticsearch-api</a>之上，详见<a href="https://github.com/elastic/elasticsearch-ruby" target="_blank" rel="noopener">gem elasticsearch-ruby</a>的README的Usage。</p>
</blockquote>
<h1 id="二、searchkick实作"><a href="#二、searchkick实作" class="headerlink" title="二、searchkick实作"></a>二、searchkick实作</h1><p><a href="https://github.com/ankane/searchkick" target="_blank" rel="noopener">gem ‘<strong>searchkick</strong>‘</a></p>
<p><a href="https://www.webascender.com/blog/rails-elasticsearch-searchkick-depth/#.WLQdQxJ96O8" target="_blank" rel="noopener">Rails，ElasticSearch和SearchKick深入</a>，进阶用法。</p>
<p><a href="https://www.driftingruby.com/episodes/searchkick-and-elasticsearch" target="_blank" rel="noopener">视频+代码教程Searchkick and Elasticsearch | Drifting Ruby</a></p>
<p><a href="http://liulupeng-blog.logdown.com/" target="_blank" rel="noopener">刘鲁鹏同学的blog elasticsearch部署linode</a></p>
<p><a href="http://www.chinapharmabook.com/apis" target="_blank" rel="noopener">刘鲁鹏作品Pharmabook</a></p>
<p><a href="https://www.youtube.com/watch?v=0j-gNrLfDFs" target="_blank" rel="noopener">视频例子 Ruby on Rails - Railscasts #306 Elasticsearch Part 1</a></p>
<p><a href="http://milesmao233.logdown.com/posts/1479410-gem-searchkick-search-function" target="_blank" rel="noopener">gem ‘searchkick’搜索功能 by-毛尧吉</a></p>
<p><a href="http://yammy-blog.logdown.com/posts/1545031" target="_blank" rel="noopener">用searchkick来实现敏捷搜索 by-yammy</a></p>
<p><a href="http://liulupeng-blog.logdown.com/posts/2132069-the-linode-server-enable-elasticsearch-quick-search" target="_blank" rel="noopener">如何在linode服务器端，实现elasticsearch敏捷搜索 by-LIULUPENG</a></p>
<p><a href="http://steventtud.logdown.com/posts/2016/09/11/862748" target="_blank" rel="noopener">Elasticsearch 實戰筆記 by-StevenTTuD</a></p>
<p>优先按刘鲁鹏，其次毛尧吉、yammy实作帖子</p>
<p>官网searchkick，以及transport和api</p>
<p>微信求助</p>
<h2 id="一、失败！！第一次测试"><a href="#一、失败！！第一次测试" class="headerlink" title="一、失败！！第一次测试"></a>一、失败！！第一次测试</h2><p><code>gem &#39;searchkick&#39;</code></p>
<p><code>brew cask install caskroom/versions/java8</code>，安装好久30分钟。</p>
<p><code>brew install elasticsearch</code>，安装好久15分钟。</p>
<p><code>brew info elasticsearch</code>，查看是否安装成功。</p>
<p><code>launchctl load ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist</code>，。。没有显示</p>
<h2 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h2><p>开启elasticsearch后，看是否有数据<a href="http://localhost:9200/?pretty" target="_blank" rel="noopener">http://localhost:9200/?pretty</a></p>
<p>1、第一次用<code>Job.reindex</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> apple@apple-2 ⮀ ~/rails/job-listing1129 ⮀ ⭠ master± ⮀ rails c</span><br><span class="line">Running via Spring preloader in process 3835</span><br><span class="line">Loading development environment (Rails 5.0.6)</span><br><span class="line">2.3.1 :001 &gt; Job.reindex</span><br><span class="line">  Job Load (5.0ms)  SELECT  &quot;jobs&quot;.* FROM &quot;jobs&quot; ORDER BY &quot;jobs&quot;.&quot;id&quot; ASC LIMIT ?  [[&quot;LIMIT&quot;, 1000]]</span><br><span class="line">  Job Import (1808.1ms)  &#123;&quot;count&quot;:998&#125;</span><br><span class="line"> =&gt; true</span><br><span class="line">2.3.1 :002 &gt; exit</span><br></pre></td></tr></table></figure>
<p>执行<code>rake searchkick:reindex CLASS=Job</code>报错，再次<code>Job.reindex</code>报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> ✘ apple@apple-2 ⮀ ~/rails/job-listing1129 ⮀ ⭠ master± ⮀ rails c</span><br><span class="line">Running via Spring preloader in process 3905</span><br><span class="line">Loading development environment (Rails 5.0.6)</span><br><span class="line">2.3.1 :001 &gt; Job.reindex</span><br><span class="line">  Job Load (3.7ms)  SELECT  &quot;jobs&quot;.* FROM &quot;jobs&quot; ORDER BY &quot;jobs&quot;.&quot;id&quot; ASC LIMIT ?  [[&quot;LIMIT&quot;, 1000]]</span><br><span class="line">  Job Import (892.0ms)  &#123;&quot;count&quot;:998&#125;</span><br><span class="line">Elasticsearch::Transport::Transport::Errors::Forbidden: [403] &#123;&quot;error&quot;:&#123;&quot;root_cause&quot;:[&#123;&quot;type&quot;:&quot;cluster_block_exception&quot;,&quot;reason&quot;:&quot;blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];&quot;&#125;],&quot;type&quot;:&quot;cluster_block_exception&quot;,&quot;reason&quot;:&quot;blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];&quot;&#125;,&quot;status&quot;:403&#125;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/base.rb:202:in `__raise_transport_error&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/base.rb:319:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/http/faraday.rb:20:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/client.rb:131:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-api-6.0.0/lib/elasticsearch/api/namespace/common.rb:21:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-api-6.0.0/lib/elasticsearch/api/actions/indices/update_aliases.rb:43:in `update_aliases&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/index.rb:70:in `promote&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/index.rb:244:in `reindex_scope&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/model.rb:72:in `searchkick_reindex&apos;</span><br><span class="line">	from (irb):1</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/console.rb:65:in `start&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/console_helper.rb:9:in `start&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/commands_tasks.rb:78:in `console&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/commands_tasks.rb:49:in `run_command!&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands.rb:18:in `&lt;top (required)&gt;&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in `require&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in `block in require&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:259:in `load_dependency&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in `require&apos;</span><br><span class="line">	from /Users/apple/rails/job-listing1129/bin/rails:9:in `&lt;top (required)&gt;&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in `load&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in `block in load&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:259:in `load_dependency&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in `load&apos;</span><br><span class="line">	from /Users/apple/.rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require&apos;</span><br><span class="line">	from /Users/apple/.rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require&apos;</span><br><span class="line">	from -e:1:in `&lt;main&gt;&apos;</span><br><span class="line">2.3.1 :002 &gt; exit</span><br></pre></td></tr></table></figure>
<p>2、删除commit重新操作，<code>Job.reindex</code>还是报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> apple@apple-2 ⮀ ~/rails/job-listing1129 ⮀ ⭠ master± ⮀ rails c</span><br><span class="line">Running via Spring preloader in process 4765</span><br><span class="line">Loading development environment (Rails 5.0.6)</span><br><span class="line">2.3.1 :001 &gt; Job.reindex</span><br><span class="line">  Job Load (0.4ms)  SELECT  &quot;jobs&quot;.* FROM &quot;jobs&quot; ORDER BY &quot;jobs&quot;.&quot;id&quot; ASC LIMIT ?  [[&quot;LIMIT&quot;, 1000]]</span><br><span class="line">Elasticsearch::Transport::Transport::Errors::Forbidden: [403] &#123;&quot;error&quot;:&#123;&quot;root_cause&quot;:[&#123;&quot;type&quot;:&quot;cluster_block_exception&quot;,&quot;reason&quot;:&quot;blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];&quot;&#125;],&quot;type&quot;:&quot;cluster_block_exception&quot;,&quot;reason&quot;:&quot;blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];&quot;&#125;,&quot;status&quot;:403&#125;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/base.rb:202:in `__raise_transport_error&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/base.rb:319:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/http/faraday.rb:20:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/client.rb:131:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-api-6.0.0/lib/elasticsearch/api/namespace/common.rb:21:in `perform_request&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-api-6.0.0/lib/elasticsearch/api/actions/indices/update_aliases.rb:43:in `update_aliases&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/index.rb:70:in `promote&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/index.rb:244:in `reindex_scope&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/model.rb:72:in `searchkick_reindex&apos;</span><br><span class="line">	from (irb):1</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/console.rb:65:in `start&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/console_helper.rb:9:in `start&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/commands_tasks.rb:78:in `console&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/commands_tasks.rb:49:in `run_command!&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands.rb:18:in `&lt;top (required)&gt;&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in `require&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in `block in require&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:259:in `load_dependency&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in `require&apos;</span><br><span class="line">	from /Users/apple/rails/job-listing1129/bin/rails:9:in `&lt;top (required)&gt;&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in `load&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in `block in load&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:259:in `load_dependency&apos;</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in `load&apos;</span><br><span class="line">	from /Users/apple/.rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require&apos;</span><br><span class="line">	from /Users/apple/.rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in `require&apos;</span><br><span class="line">	from -e:1:in `&lt;main&gt;&apos;</span><br><span class="line">2.3.1 :002 &gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Elasticsearch transport error 403, when Product.reindex in the local</span><br><span class="line"></span><br><span class="line">When &quot;Add data to the search index&quot;, I run &quot;Job. reindex&quot; in `rails c`, then return an error as follows.</span><br><span class="line"></span><br><span class="line">​</span><br></pre></td></tr></table></figure>
<p> apple@apple-2 ⮀ ~/rails/job-listing1129 ⮀ ⭠ master± ⮀ rails c<br>Running via Spring preloader in process 4765<br>Loading development environment (Rails 5.0.6)<br>2.3.1 :001 &gt; Job.reindex<br>  Job Load (0.4ms)  SELECT  “jobs”.* FROM “jobs” ORDER BY “jobs”.”id” ASC LIMIT ?  [[“LIMIT”, 1000]]<br>Elasticsearch::Transport::Transport::Errors::Forbidden: [403] {“error”:{“root_cause”:[{“type”:”cluster_block_exception”,”reason”:”blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];”}],”type”:”cluster_block_exception”,”reason”:”blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];”},”status”:403}<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/base.rb:202:in <code>__raise_transport_error&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/base.rb:319:in</code>perform_request’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/transport/http/faraday.rb:20:in <code>perform_request&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-transport-6.0.0/lib/elasticsearch/transport/client.rb:131:in</code>perform_request’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-api-6.0.0/lib/elasticsearch/api/namespace/common.rb:21:in <code>perform_request&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/elasticsearch-api-6.0.0/lib/elasticsearch/api/actions/indices/update_aliases.rb:43:in</code>update_aliases’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/index.rb:70:in <code>promote&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/index.rb:244:in</code>reindex_scope’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/searchkick-2.4.0/lib/searchkick/model.rb:72:in <code>searchkick_reindex&#39;
    from (irb):1
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/console.rb:65:in</code>start’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/console_helper.rb:9:in <code>start&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/commands_tasks.rb:78:in</code>console’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands/commands_tasks.rb:49:in <code>run_command!&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/railties-5.0.6/lib/rails/commands.rb:18:in</code><top (required)="">‘<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in <code>require&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in</code>block in require’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:259:in <code>load_dependency&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:293:in</code>require’<br>    from /Users/apple/rails/job-listing1129/bin/rails:9:in <code>&lt;top (required)&gt;&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in</code>load’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in <code>block in load&#39;
    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:259:in</code>load_dependency’<br>    from /Users/apple/.rvm/gems/ruby-2.3.1/gems/activesupport-5.0.6/lib/active_support/dependencies.rb:287:in <code>load&#39;
    from /Users/apple/.rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in</code>require’<br>    from /Users/apple/.rvm/rubies/ruby-2.3.1/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb:55:in <code>require&#39;
    from -e:1:in</code><main>‘<br>2.3.1 :002 &gt;<br>​<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">I try to find solution in Google and stackoverflow, but did not find it.</span><br><span class="line">I am very new to be a coder. I use ruby on rails.</span><br><span class="line">I hope I didn&apos;t bring trouble to you.</span><br></pre></td></tr></table></figure></main></top></p>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">by 99</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/posts/d16694c4/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/posts/5ee8c435/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMzE1My85NzEx">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>


            </main>
            
    <aside class="col-md-3 sidebar">
        
        <!-- 
    <div class="widget">
        <h3 class="title">Search</h3>
        <div id="search-form">
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?">
                    <button type="button" class="search-form-submit" id="search-local">搜索</button>
                
                
            </div>
            <div id="result-wrap" class="hide">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>
 -->

        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>你好，我是99。<br/>欢迎来到我的博客。<br/>
<br/>
<hr/>接受贡献，包括不限于提交问题与需求，修复代码。欢迎Pull Request<br/>支持主题：<a href="https://github.com/shenliyang/hexo-theme-snippet/stargazers">Star一下</a>
</p>
        </div>
    </div>

        
        
    <div class="widget">
      <h3 class="title">Social</h3> 
        <div class="content social">
            
	            <a href="//github.com/shenliyang" rel="external nofollow" title="Github" target="_blank">
			    	<i class="git fa fa-git"></i>
			    </a>
            
	            <a href="mailto:snippet@91h5.cc" rel="external nofollow" title="邮箱" target="_blank">
			    	<i class="envelope-o fa fa-envelope-o"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="联系QQ" target="_blank">
			    	<i class="qq fa fa-qq"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="微博" target="_blank">
			    	<i class="weibo fa fa-weibo"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="QQ群" target="_blank">
			    	<i class="users fa fa-users"></i>
			    </a>
            
	            <a href="/atom.xml" rel="external nofollow" title="RSS" target="_blank">
			    	<i class="feed fa fa-feed"></i>
			    </a>
            
        </div>
    </div>


        
        
    <div class="widget">
        <h3 class="title">Categories</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ror功能/"><i class="fa" aria-hidden="true">ror功能</i></a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ror知识点/"><i class="fa" aria-hidden="true">ror知识点</i></a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ror系统/"><i class="fa" aria-hidden="true">ror系统</i></a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web页面/"><i class="fa" aria-hidden="true">web页面</i></a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link current" href="/categories/工具/"><i class="fa" aria-hidden="true">工具</i></a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微信小程序/"><i class="fa" aria-hidden="true">微信小程序</i></a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心得/"><i class="fa" aria-hidden="true">心得</i></a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/投资/"><i class="fa" aria-hidden="true">投资</i></a><span class="category-list-count">1</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">Archives</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/"><i class="fa" aria-hidden="true">November 2018</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/"><i class="fa" aria-hidden="true">January 2018</i></a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/"><i class="fa" aria-hidden="true">December 2017</i></a><span class="archive-list-count">34</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/"><i class="fa" aria-hidden="true">November 2017</i></a><span class="archive-list-count">35</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/"><i class="fa" aria-hidden="true">September 2017</i></a><span class="archive-list-count">1</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">Tag Cloud</h3>
    <div class="content tag-cloud">
        <a href="/tags/atom/" style="font-size: 14px;">atom</a> <a href="/tags/bug/" style="font-size: 18px;">bug</a> <a href="/tags/heroku/" style="font-size: 10px;">heroku</a> <a href="/tags/hexo/" style="font-size: 12px;">hexo</a> <a href="/tags/interview/" style="font-size: 11px;">interview</a> <a href="/tags/mac/" style="font-size: 12px;">mac</a> <a href="/tags/orid-day/" style="font-size: 10px;">orid-day</a> <a href="/tags/orid-month/" style="font-size: 11px;">orid-month</a> <a href="/tags/ror功能/" style="font-size: 12px;">ror功能</a> <a href="/tags/ror知识点/" style="font-size: 17px;">ror知识点</a> <a href="/tags/ror系统/" style="font-size: 19px;">ror系统</a> <a href="/tags/typora/" style="font-size: 10px;">typora</a> <a href="/tags/vps/" style="font-size: 16px;">vps</a> <a href="/tags/web页面/" style="font-size: 12px;">web页面</a> <a href="/tags/下载/" style="font-size: 10px;">下载</a> <a href="/tags/工具/" style="font-size: 20px;">工具</a> <a href="/tags/常用/" style="font-size: 13px;">常用</a> <a href="/tags/微信功能/" style="font-size: 13px;">微信功能</a> <a href="/tags/微信系统/" style="font-size: 15px;">微信系统</a> <a href="/tags/微信页面/" style="font-size: 11px;">微信页面</a> <a href="/tags/心得/" style="font-size: 14px;">心得</a> <a href="/tags/手机/" style="font-size: 10px;">手机</a> <a href="/tags/投资/" style="font-size: 10px;">投资</a> <a href="/tags/搬砖/" style="font-size: 10px;">搬砖</a> <a href="/tags/科学上网/" style="font-size: 14px;">科学上网</a> <a href="/tags/部署/" style="font-size: 13px;">部署</a>
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">Friends</h3>
        <div class="content friends-link">
        
            <a href="http://www.shenliyang.com" class="fa" target="_blank">个人博客</a>
        
        </div>
    </div>


        
    </aside>


        </div>
      </section>
    </div>
  </div>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <span>Copyright &copy; 2018
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



	<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
