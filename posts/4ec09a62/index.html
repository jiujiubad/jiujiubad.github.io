<!DOCTYPE HTML>
<html>
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>《ruby on rails 实战圣经》rails篇 | Hexo</title>


    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
    <div class="hide">
    	<script src="https://s4.cnzz.com/z_stat.php?id=1263868967&web_id=1263868967" language="JavaScript"></script>
    </div>






    
</head>

<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
  <div class="container-fluid">
    <div class="row">
      <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner2.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="">
            <img src="/img/avatar.jpg" alt="logo头像">
        </a>
        <div class="branding1">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 记录，把握点滴  ——by 99 </h2>
            
    	</div>
    </div>
</header>

      <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation itit"><a href="/"><i class="fa fa-fw "></i>主页</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/archives/"><i class="fa fa-fw "></i>所有</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/posts/d16694c4/"><i class="fa fa-fw "></i>标题</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/categories/ror系统/"><i class="fa fa-fw "></i>ror系统</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/categories/微信小程序/"><i class="fa fa-fw "></i>微信小程序</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/"><i class="fa fa-fw "></i>关于我</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>

      <section class="content-wra aa99">
        <!-- <div class="row">
          
    <div class="widget" style="padding:0 15px;">
        <div id="search-form" > 
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?" style="width:100%;border-radius:0;">

                
                
            </div>
            <div id="result-wrap" class="hide" style="padding:0 20px;">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>


        </div> -->
        <div class="row">
            <main class="col-md-9 main-content m-post">
                <p id="process"></p>
<article class="post pp99">
    <div class="post-head">
        <h1 id="《ruby on rails 实战圣经》rails篇">
            
	            《ruby on rails 实战圣经》rails篇
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <span>ror系统</span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            ror系统
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2018/01/20</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h1 id="一、Ruby-on-rails-1-简介"><a href="#一、Ruby-on-rails-1-简介" class="headerlink" title="一、Ruby on rails 1 简介"></a>一、Ruby on rails 1 简介</h1><h2 id="1、经历"><a href="#1、经历" class="headerlink" title="1、经历"></a>1、经历</h2><p>Perl CGI，用程式输出html。2000年动态网。</p>
<p>php，在html里面内嵌程式的写法，<code>&lt;?php...?&gt;</code>。</p>
<p>php&amp;mysql，开头在&lt;?php..?&gt;里连接资料库，主体html里用sql操作资料库，用php把资料印出来。2000年初动态网。</p>
<p>2005，因为php代码会越做越混乱，自己刻php web framework，用于学校系统。 </p>
<ul>
<li>MVC，更系统地组织代码</li>
<li>ORM，使用物件导向语法操作资料库 </li>
<li>ORL，自有弹性的网址 </li>
</ul>
<h2 id="2、ruby-on-rails特色"><a href="#2、ruby-on-rails特色" class="headerlink" title="2、ruby on rails特色"></a>2、ruby on rails特色</h2><p>ruby on rails设计原则与特色</p>
<p>1、不重复自己。</p>
<p>2、惯例优于设定。</p>
<h1 id="二、Ruby-on-rails-2-安装"><a href="#二、Ruby-on-rails-2-安装" class="headerlink" title="二、Ruby on rails 2 安装"></a>二、Ruby on rails 2 安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem list #列出所有的gem清单</span><br></pre></td></tr></table></figure>
<p>ruby安装</p>
<p>rails安装</p>
<h1 id="三、Ruby-on-rails-3-起步走"><a href="#三、Ruby-on-rails-3-起步走" class="headerlink" title="三、Ruby on rails 3 起步走"></a>三、Ruby on rails 3 起步走</h1><h2 id="1、新建专案"><a href="#1、新建专案" class="headerlink" title="1、新建专案"></a>1、新建专案</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails new demo --skip-test-unit</span><br></pre></td></tr></table></figure>
<p>命令附加参数是忽略掉测试的目录，因为我们会用rspc测试框架而不是rails内建的test-unit。不过2017版的ruby好像改善测试了。</p>
<p><strong>index.html.erb</strong>，这里的erb是用ruby语法的意思，在文件里可以运算ruby，比如&lt;%= 1+1 %&gt;。</p>
<p><strong>link_to</strong>是rails提供的方法，在view里我们叫它helper。</p>
<h2 id="2、新建资料库"><a href="#2、新建资料库" class="headerlink" title="2、新建资料库"></a>2、新建资料库</h2><p><code>rake db:create</code>，建立sqlite3资料库。</p>
<h2 id="3、快速产生预设demo样板"><a href="#3、快速产生预设demo样板" class="headerlink" title="3、快速产生预设demo样板"></a>3、快速产生预设demo样板</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g scaffold person name:string bio:text birthday:date</span><br></pre></td></tr></table></figure>
<p>会快速产生MVC程式码，快速产生CRUD、路由、model、view、db等预设的文件。——有经验的工程师一般不用。</p>
<p><code>rake db:migrate</code>，实际在资料库建立table。</p>
<h1 id="四、Ruby-on-rails-4-手工打造CRUD应用程式"><a href="#四、Ruby-on-rails-4-手工打造CRUD应用程式" class="headerlink" title="四、Ruby on rails 4 手工打造CRUD应用程式"></a>四、Ruby on rails 4 手工打造CRUD应用程式</h1><h2 id="1、SourceTree工具，管理git"><a href="#1、SourceTree工具，管理git" class="headerlink" title="1、SourceTree工具，管理git"></a>1、SourceTree工具，管理git</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stree #打开SourceTree工具</span><br></pre></td></tr></table></figure>
<p>用法在5分钟的时候，看不懂？？？</p>
<h2 id="2、rails-c里，操作资料库："><a href="#2、rails-c里，操作资料库：" class="headerlink" title="2、rails c里，操作资料库："></a>2、rails c里，操作资料库：</h2><p>x = Event.find(1)，查找id为1的资料。</p>
<p>更新资料x.name = “RAisl”。</p>
<p>Event.where(:opacity =&gt; 100).first</p>
<p>Event.where( [“opacity &gt;= ?”, 100] ).limit(3).order(“id desc”)</p>
<p>x.errors，看报错。</p>
<p>x.errors.full_messages，看具体报错。</p>
<h2 id="3、DB-Browser工具，查看migration"><a href="#3、DB-Browser工具，查看migration" class="headerlink" title="3、DB Browser工具，查看migration"></a>3、DB Browser工具，查看migration</h2><p>用于打开table的档案，看这个table长什么样子。</p>
<p>rails migration的好处：①、纳入git版本管理；②、应用程式升级时，只要rake db:migrate；③、跨资料库通用的，不需要修改代码。</p>
<p>添加栏位时，如果model已经建立过，就不需要再建立model，直接用rails g migration。</p>
<h2 id="4、资料验证validation"><a href="#4、资料验证validation" class="headerlink" title="4、资料验证validation"></a>4、资料验证validation</h2><h2 id="5、外卡路由（不安全）"><a href="#5、外卡路由（不安全）" class="headerlink" title="5、外卡路由（不安全）"></a>5、外卡路由（不安全）</h2><p><code>match &#39;:controller(/:action(/:id(.:format)))&#39;, :via =&gt; :all</code>  ，万能的路由设置方法/foo/bar，第一段是controller，第二段是action。</p>
<p>放在最下面是因为处理顺序是从上到下，如果上面有自定义的会优先执行。</p>
<h2 id="6、新建controller"><a href="#6、新建controller" class="headerlink" title="6、新建controller"></a>6、新建controller</h2><h3 id="6-1-event是什么？"><a href="#6-1-event是什么？" class="headerlink" title="6.1 @event是什么？"></a>6.1 @event是什么？</h3><p>所有在controller里带有小老鼠@的变量，都会传到template使用。</p>
<h3 id="6-2-params-event-是什么？"><a href="#6-2-params-event-是什么？" class="headerlink" title="6.2 params[:event]是什么？"></a>6.2 params[:event]是什么？</h3><p>在create时，查看rails s里的信息，params就是送出的params代表的那笔资料。</p>
<p>在rails c中，可以这样写Event.new( :name =&gt; “QQ”, :description =&gt; “fdsfds”)；</p>
<p>在controller中，写法类似，都是在new里初始化一个hash，比如下面的params[:event]就是用一个hash来传递参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def create</span><br><span class="line">  @event = Event.new(params[:event]) //因为浏览器安全过滤，这部分还要再提取到event_params里</span><br><span class="line">  @event.save</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="7、页面"><a href="#7、页面" class="headerlink" title="7、页面"></a>7、页面</h2><p>simple_format，自动换行。</p>
<h2 id="8、其他小功能"><a href="#8、其他小功能" class="headerlink" title="8、其他小功能"></a>8、其他小功能</h2><h2 id="1、layout"><a href="#1、layout" class="headerlink" title="1、layout"></a>1、layout</h2><p>比如在controller设置<code>@page_title = @event.name</code>，然后在layout设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;&lt;%= @page_title || &quot;JDstore&quot; %&gt;&lt;/title&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2、partial-template"><a href="#2、partial-template" class="headerlink" title="2、partial template"></a>2、partial template</h2><p>即重复使用template样板。  </p>
<h2 id="3、before-action"><a href="#3、before-action" class="headerlink" title="3、before_action"></a>3、before_action</h2><p>重构controller里的Event.find()。</p>
<h2 id="4、新增-编辑时显示错误信息"><a href="#4、新增-编辑时显示错误信息" class="headerlink" title="4、新增/编辑时显示错误信息"></a>4、新增/编辑时显示错误信息</h2><p>reder，返回，会保留已经编辑了一半的数据。</p>
<p>redirect_to，重定向，正在编辑的数据会被清除重新打开xx页面。</p>
<h2 id="5、flash"><a href="#5、flash" class="headerlink" title="5、flash"></a>5、flash</h2><h2 id="6、rails-c跑回圈"><a href="#6、rails-c跑回圈" class="headerlink" title="6、rails c跑回圈"></a>6、rails c跑回圈</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">100.times do |i|</span><br><span class="line">  Event.create( :name =&gt; &quot;Event #&#123;i&#125;&quot;)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="7、分页kaminnari"><a href="#7、分页kaminnari" class="headerlink" title="7、分页kaminnari"></a>7、分页kaminnari</h2><h1 id="五、Ruby-on-rails-5-1-RESTFUL"><a href="#五、Ruby-on-rails-5-1-RESTFUL" class="headerlink" title="五、Ruby on rails 5-1 RESTFUL"></a>五、Ruby on rails 5-1 RESTFUL</h1><p>《ruby on rails实战圣经》<a href="https://ihower.tw/rails/" target="_blank" rel="noopener">https://ihower.tw/rails/</a></p>
<p>取代外卡路由的写法，外卡路由代码臃肿，且太自由有安全隐患。</p>
<h1 id="六、Ruby-on-rails-5-2-RESTFUL"><a href="#六、Ruby-on-rails-5-2-RESTFUL" class="headerlink" title="六、Ruby on rails 5-2 RESTFUL"></a>六、Ruby on rails 5-2 RESTFUL</h1><h1 id="七、Ruby-on-rails-5-3-RESTFUL"><a href="#七、Ruby-on-rails-5-3-RESTFUL" class="headerlink" title="七、Ruby on rails 5-3 RESTFUL"></a>七、Ruby on rails 5-3 RESTFUL</h1><p>REST的核心精神：</p>
<ul>
<li>提供routing设计准则，以及controller、action命名和组织惯例。</li>
</ul>
<ul>
<li>同个action，可以respond_to不同的format格式。</li>
</ul>
<p>rails的命名惯例，分三段action.format.render，即action.格式.引擎。比如index.html.erb、index.xml.builder。</p>
<h1 id="八、Ruby-on-rails-5-4-RESTFUL"><a href="#八、Ruby-on-rails-5-4-RESTFUL" class="headerlink" title="八、Ruby on rails 5-4 RESTFUL"></a>八、Ruby on rails 5-4 RESTFUL</h1><h2 id="1、写法"><a href="#1、写法" class="headerlink" title="1、写法"></a>1、写法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def index</span><br><span class="line">  @events = Event.all</span><br><span class="line">  respond_to do |format|</span><br><span class="line">    format.html #index.html.erb</span><br><span class="line">    format.xml&#123;</span><br><span class="line">      render :xml =&gt; @events.to_xml</span><br><span class="line">    &#125;</span><br><span class="line">    format.json&#123;</span><br><span class="line">      render :json =&gt; @events.to_json</span><br><span class="line">    &#125;</span><br><span class="line">    format.atom&#123;</span><br><span class="line">      @feed_title = &quot;My event list&quot;</span><br><span class="line">  	&#125; #index.atom.builder</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>chrome显示样式，安装插件json formatter。</p>
<p>json指定具体栏位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">format.json&#123;</span><br><span class="line">  render :json =&gt; &#123;id:@event.id, name:@event.name&#125;.to_json</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拿json，只要稍微修改路径。比如<code>&lt;%=link_to(&#39;get json&#39;, event_path(e, :format=&gt; :json)) %&gt;</code>。</p>
<p>命令<code>rake stats</code>，计算写了多少行代码。</p>
<h2 id="2、如何除错debug"><a href="#2、如何除错debug" class="headerlink" title="2、如何除错debug"></a>2、如何除错debug</h2><p>在html，&lt;%= debug(@events[0]) %&gt;</p>
<p>在controller， Rails.logger.debug(“xxxx”: + @events.count) </p>
<h1 id="九、Ruby-on-rails-6-Heroku"><a href="#九、Ruby-on-rails-6-Heroku" class="headerlink" title="九、Ruby on rails 6 Heroku"></a>九、Ruby on rails 6 Heroku</h1><h1 id="十、Ruby-on-rails-7-Bootstrap"><a href="#十、Ruby-on-rails-7-Bootstrap" class="headerlink" title="十、Ruby on rails 7 Bootstrap"></a>十、Ruby on rails 7 Bootstrap</h1><h2 id="1、rails的功能Asset-Pipeline"><a href="#1、rails的功能Asset-Pipeline" class="headerlink" title="1、rails的功能Asset Pipeline"></a>1、rails的功能Asset Pipeline</h2><p>前端的东西统一由rails来管理。 会把所有css、js配置压缩打包在head里的档案中，所以会加快浏览器下载速度，因为会减少浏览器发request的次数。</p>
<p>另外，它还支援其他css、js的写法。</p>
<ul>
<li>比如，最出名的<a href="sass-lang.com">sass</a>是进阶的css写法，支援变数、nesting写法、partial写法、import等。</li>
<li>比如，js的<a href="coffeescript.org">CoffeeScript</a>，支援class继承写法，看起来像ruby但会转成js。 </li>
</ul>
<p>一般会在部署的过程做compile，比如用命令模拟<code>rake assets:precompile</code>，会在public的文件夹里出现编译的结果。</p>
<p>如何处理图片</p>
<p><code>cp ~/Picture/xx.png app/assets/images</code>，复制照片。</p>
<p>用image_tag这个rails的helper调用，<code>&lt;%= image_tag(&quot;xx.png&quot;) %&gt;</code>。</p>
<p>如何在css调用图片档名？</p>
<ul>
<li><p>办法一（常用）：把application.css改为application.css.scss</p>
<ul>
<li><code>background-image: image-url(&quot;xx.png&quot;);</code></li>
</ul>
</li>
<li><p>办法二：把文件名由application.css改为application.css.erb，用asset_path这个help找到实际档名</p>
<ul>
<li><code>background-image: url(&#39;&lt;%= asset_path(&quot;xx.png&quot;)&#39;);</code></li>
</ul>
</li>
</ul>
<h1 id="十一、Ruby-on-rails-8-1-一对多"><a href="#十一、Ruby-on-rails-8-1-一对多" class="headerlink" title="十一、Ruby on rails 8-1 一对多"></a>十一、Ruby on rails 8-1 一对多</h1><h2 id="1、可以修改自己的专案："><a href="#1、可以修改自己的专案：" class="headerlink" title="1、可以修改自己的专案："></a>1、可以修改自己的专案：</h2><p>1）新建model时为外键生成索引，<code>add_index :attedees, :event_id</code>。</p>
<p>2）路由重命名，ihower个人喜好用event_attendees。</p>
<p>3）before_action :find_event。</p>
<p>4）外键加索引add_index。</p>
<h1 id="十二、Ruby-on-rails-8-2-一对多"><a href="#十二、Ruby-on-rails-8-2-一对多" class="headerlink" title="十二、Ruby on rails 8-2 一对多"></a>十二、Ruby on rails 8-2 一对多</h1><p>下拉单选有三种写法，以下两种，加上第10讲collection的二维阵列（没有用循环）。</p>
<h2 id="1、下拉单选用select。"><a href="#1、下拉单选用select。" class="headerlink" title="1、下拉单选用select。"></a>1、下拉单选用select。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.select :category_id Category.all.map&#123; |x| [x.name, x.id] &#125; %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2、下拉单选用f-collection，效果同1）。"><a href="#2、下拉单选用f-collection，效果同1）。" class="headerlink" title="2、下拉单选用f.collection，效果同1）。"></a>2、下拉单选用f.collection，效果同1）。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.collection_select :category_id Category.all, :id, :name %&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>增加预设的空值，在后面加上<code>:include_blank =&gt; &quot;Please select&quot;</code></li>
<li>增加预设空值，也可以用<code>:prompt =&gt; &quot;Please select&quot;</code>，新增是会有这个选项，但是编辑时没有。</li>
</ul>
<h2 id="3、ABCD单选用radio-button"><a href="#3、ABCD单选用radio-button" class="headerlink" title="3、ABCD单选用radio_button"></a>3、ABCD单选用radio_button</h2><p>比如单选event属于什么分类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;% Category.all.each do |c| %&gt;</span><br><span class="line">  &lt;%= f.radio_button :category_id, c.id %&gt; </span><br><span class="line">  &lt;%= c.name %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2、新增栏位，旧数据报错的处理办法："><a href="#2、新增栏位，旧数据报错的处理办法：" class="headerlink" title="2、新增栏位，旧数据报错的处理办法："></a>2、新增栏位，旧数据报错的处理办法：</h2><p>1）用try，比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= @event.category.try(:name) %&gt;</span><br></pre></td></tr></table></figure>
<p>2）用delegate。比如在model增加宣告</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delegate name, :to =&gt; category, :perifx =&gt; true, :allow_nil =&gt; true</span><br></pre></td></tr></table></figure>
<p>在view修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= @event.category_name) %&gt;</span><br></pre></td></tr></table></figure>
<h1 id="十三、Ruby-on-rails-9-多对多"><a href="#十三、Ruby-on-rails-9-多对多" class="headerlink" title="十三、Ruby on rails 9 多对多"></a>十三、Ruby on rails 9 多对多</h1><h2 id="1、同百宝箱核选方块："><a href="#1、同百宝箱核选方块：" class="headerlink" title="1、同百宝箱核选方块："></a>1、同百宝箱核选方块：</h2><p>1）在view用collection_check_boxes。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= f.collection_check_boxes(:group_ids, Group.all, :id, :name) %&gt;</span><br></pre></td></tr></table></figure>
<p>并在controlle白名单的最后加上<code>:groups_ids =&gt; []</code>，注意要放在最后。</p>
<h1 id="十四、Ruby-on-rails-10-RESTFUL-collection"><a href="#十四、Ruby-on-rails-10-RESTFUL-collection" class="headerlink" title="十四、Ruby on rails 10 RESTFUL collection"></a>十四、Ruby on rails 10 RESTFUL collection</h1><h2 id="1、案例一，客制化自己的路由get。"><a href="#1、案例一，客制化自己的路由get。" class="headerlink" title="1、案例一，客制化自己的路由get。"></a>1、案例一，客制化自己的路由get。</h2><h2 id="2、案例二，一次删除多笔资料post。"><a href="#2、案例二，一次删除多笔资料post。" class="headerlink" title="2、案例二，一次删除多笔资料post。"></a>2、案例二，一次删除多笔资料post。</h2><p>1）veiw用form标签，或用button_to实际上会自带form标签。</p>
<p>2）controller</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def bulk_delete</span><br><span class="line">  Event.destroy_all</span><br><span class="line">  redirect_to :back</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="3、案例三，用核选方块选择删除-编辑哪些资料post。"><a href="#3、案例三，用核选方块选择删除-编辑哪些资料post。" class="headerlink" title="3、案例三，用核选方块选择删除/编辑哪些资料post。"></a>3、案例三，用核选方块选择删除/编辑哪些资料post。</h2><p>1）view用form标签。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= form_tag bulk_update_events_path do %&gt;</span><br><span class="line">  &lt;% @events.each do |e| %&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;</span><br><span class="line">        &lt;%= check_box_tag &quot;ids[]&quot;, e.id, false %&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">    ....</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">  &lt;% end %&gt;</span><br><span class="line">  &lt;%= submit_tag &quot;Delete&quot; %&gt;</span><br><span class="line">  &lt;%= submit_tag &quot;Publish&quot; %&gt;</span><br><span class="line">&lt;% end %&gt;</span><br></pre></td></tr></table></figure>
<p>2）controller，用Array方法让传进来的参数不管是不是数组都转化成数组，比如当参数是1或nil时。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def bulk_update</span><br><span class="line">  ids = Array(params[:ids])</span><br><span class="line">  events = ids.map&#123; |i| Event.find_by_id(i) &#125;.compact</span><br><span class="line">  </span><br><span class="line">  if params[:commit] = &quot;Delete&quot;</span><br><span class="line">    events.each&#123; |e| e.destroy&#125;</span><br><span class="line">  elsif params[:commit] = &quot;Publish&quot;</span><br><span class="line">    events.each&#123; |e| e.update(:status =&gt; &quot;published&quot;) &#125;</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  redirect_to :back</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<ul>
<li>如果是find(i)找不到会丢一个例外出来，如果用find_by_id(i)找不到会回传nil。</li>
<li>compact，会把阵列里的nil去除。</li>
<li>chrome检查”Delete”按钮、”Publish”按钮，看到都是name=”commit”。在console log也可以看到。</li>
</ul>
<p>3）用二维阵列做status的下拉选单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">  &lt;%= f.label :status, &quot;Status&quot; %&gt;</span><br><span class="line">  &lt;%= f.select :status, [[&quot;Published&quot;, &quot;published&quot;],[&quot;Draft&quot;, &quot;draft&quot;]] %&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h1 id="十五、Ruby-on-rails-11-RESTFUL-member"><a href="#十五、Ruby-on-rails-11-RESTFUL-member" class="headerlink" title="十五、Ruby on rails 11 RESTFUL member"></a>十五、Ruby on rails 11 RESTFUL member</h1><p>自定义每笔资料的页面。</p>
<h1 id="十六、Ruby-on-rails-12-RESTFUL其他"><a href="#十六、Ruby-on-rails-12-RESTFUL其他" class="headerlink" title="十六、Ruby on rails 12 RESTFUL其他"></a>十六、Ruby on rails 12 RESTFUL其他</h1><p>在同个页面做过滤，相当于关键字搜寻。</p>
<p>排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if params[:keyword]</span><br><span class="line">  xxx</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">if params[:order]</span><br><span class="line">  xxx</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h1 id="十七、Ruby-on-rails-13-RESTFUL-namespace"><a href="#十七、Ruby-on-rails-13-RESTFUL-namespace" class="headerlink" title="十七、Ruby on rails 13 RESTFUL namespace"></a>十七、Ruby on rails 13 RESTFUL namespace</h1><h1 id="十八、Ruby-on-rails-14-Devise"><a href="#十八、Ruby-on-rails-14-Devise" class="headerlink" title="十八、Ruby on rails 14 Devise"></a>十八、Ruby on rails 14 Devise</h1><h1 id="十九、Ruby-on-rails-15-Rake"><a href="#十九、Ruby-on-rails-15-Rake" class="headerlink" title="十九、Ruby on rails 15 Rake"></a>十九、Ruby on rails 15 Rake</h1><h1 id="二十、Ruby-on-rails-16-Authorization用户权限"><a href="#二十、Ruby-on-rails-16-Authorization用户权限" class="headerlink" title="二十、Ruby on rails 16 Authorization用户权限"></a>二十、Ruby on rails 16 Authorization用户权限</h1><h1 id="二十一、Ruby-on-rails-17-paperclip上传"><a href="#二十一、Ruby-on-rails-17-paperclip上传" class="headerlink" title="二十一、Ruby on rails 17 paperclip上传"></a>二十一、Ruby on rails 17 paperclip上传</h1>
    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">by 99</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/posts/b42ceda9/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/posts/4f973b9d/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMzE1My85NzEx">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>


            </main>
            
    <aside class="col-md-3 sidebar">
        
        
    <div class="widget">
        <h3 class="title">Search</h3>
        <div id="search-form">
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?">
                    <button type="button" class="search-form-submit" id="search-local">搜索</button>
                
                
            </div>
            <div id="result-wrap" class="hide">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>


        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>你好，我是99。<br/>欢迎来到我的博客。<br/>
<br/>
<hr/>接受贡献，包括不限于提交问题与需求，修复代码。欢迎Pull Request<br/>支持主题：<a href="https://github.com/shenliyang/hexo-theme-snippet/stargazers">Star一下</a>
</p>
        </div>
    </div>

        
        
    <div class="widget">
      <h3 class="title">Social</h3> 
        <div class="content social">
            
	            <a href="https://github.com/jiujiubad?tab=repositories" rel="external nofollow" title="Github" target="_blank">
			    	<i class="github fa fa-github"></i>
			    </a>
            
	            <a href="jiujiubad@gmail.com" rel="external nofollow" title="邮箱" target="_blank">
			    	<i class="envelope-o fa fa-envelope-o"></i>
			    </a>
            
	            <a href="https://ws4.sinaimg.cn/large/006tNc79ly1fnvcxiavzgj30by0bymxg.jpg" rel="external nofollow" title="微信" target="_blank">
			    	<i class="weixin fa fa-weixin"></i>
			    </a>
            
        </div>
    </div>


        
        
    <div class="widget">
        <h3 class="title">Categories</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ror功能/"><i class="fa" aria-hidden="true">ror功能</i></a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ror知识点/"><i class="fa" aria-hidden="true">ror知识点</i></a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link current" href="/categories/ror系统/"><i class="fa" aria-hidden="true">ror系统</i></a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web页面/"><i class="fa" aria-hidden="true">web页面</i></a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/"><i class="fa" aria-hidden="true">工具</i></a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微信小程序/"><i class="fa" aria-hidden="true">微信小程序</i></a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心得/"><i class="fa" aria-hidden="true">心得</i></a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/投资/"><i class="fa" aria-hidden="true">投资</i></a><span class="category-list-count">1</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">Archives</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/"><i class="fa" aria-hidden="true">January 2018</i></a><span class="archive-list-count">37</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/"><i class="fa" aria-hidden="true">December 2017</i></a><span class="archive-list-count">35</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/"><i class="fa" aria-hidden="true">November 2017</i></a><span class="archive-list-count">36</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/"><i class="fa" aria-hidden="true">September 2017</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/"><i class="fa" aria-hidden="true">April 2017</i></a><span class="archive-list-count">1</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">Tag Cloud</h3>
    <div class="content tag-cloud">
        <a href="/tags/atom/" style="font-size: 14.44px;">atom</a> <a href="/tags/bug/" style="font-size: 18.89px;">bug</a> <a href="/tags/heroku/" style="font-size: 10px;">heroku</a> <a href="/tags/hexo/" style="font-size: 12.22px;">hexo</a> <a href="/tags/interview/" style="font-size: 13.33px;">interview</a> <a href="/tags/mac/" style="font-size: 12.22px;">mac</a> <a href="/tags/orid-day/" style="font-size: 10px;">orid-day</a> <a href="/tags/orid-month/" style="font-size: 12.22px;">orid-month</a> <a href="/tags/ror功能/" style="font-size: 14.44px;">ror功能</a> <a href="/tags/ror知识点/" style="font-size: 17.78px;">ror知识点</a> <a href="/tags/ror系统/" style="font-size: 20px;">ror系统</a> <a href="/tags/stackoverflow/" style="font-size: 10px;">stackoverflow</a> <a href="/tags/typora/" style="font-size: 10px;">typora</a> <a href="/tags/vps/" style="font-size: 16.67px;">vps</a> <a href="/tags/web页面/" style="font-size: 12.22px;">web页面</a> <a href="/tags/下载/" style="font-size: 10px;">下载</a> <a href="/tags/工具/" style="font-size: 20px;">工具</a> <a href="/tags/常用/" style="font-size: 14.44px;">常用</a> <a href="/tags/微信功能/" style="font-size: 13.33px;">微信功能</a> <a href="/tags/微信系统/" style="font-size: 15.56px;">微信系统</a> <a href="/tags/微信页面/" style="font-size: 11.11px;">微信页面</a> <a href="/tags/心得/" style="font-size: 17.78px;">心得</a> <a href="/tags/手机/" style="font-size: 10px;">手机</a> <a href="/tags/投资/" style="font-size: 10px;">投资</a> <a href="/tags/搬砖/" style="font-size: 10px;">搬砖</a> <a href="/tags/核聚编程/" style="font-size: 14.44px;">核聚编程</a> <a href="/tags/科学上网/" style="font-size: 14.44px;">科学上网</a> <a href="/tags/部署/" style="font-size: 13.33px;">部署</a>
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">Friends</h3>
        <div class="content friends-link">
        
            <a href="http://www.shenliyang.com" class="fa" target="_blank">个人博客</a>
        
        </div>
    </div>


        
    </aside>


        </div>
      </section>
    </div>
  </div>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <span>Copyright &copy; 2018
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



	<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
