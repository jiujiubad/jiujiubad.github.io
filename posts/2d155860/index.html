<!DOCTYPE HTML>
<html>
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>ror-system-rails tutorial笔记 | Hexo</title>


    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
    <div class="hide">
    	<script src="https://s4.cnzz.com/z_stat.php?id=1263868967&web_id=1263868967" language="JavaScript"></script>
    </div>






    
</head>

<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
  <div class="container-fluid">
    <div class="row">
      <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner2.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="">
            <img src="/img/avatar.jpg" alt="logo头像">
        </a>
        <div class="branding1">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 记录，把握点滴  ——by 99 </h2>
            
    	</div>
    </div>
</header>

      <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation itit"><a href="/"><i class="fa fa-fw "></i>主页</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/archives/"><i class="fa fa-fw "></i>所有</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/posts/d16694c4/"><i class="fa fa-fw "></i>标题</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/categories/ror系统/"><i class="fa fa-fw "></i>ror系统</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/categories/微信小程序/"><i class="fa fa-fw "></i>微信小程序</a>
                            </li>
                        
                            <li role="presentation itit"><a href="/"><i class="fa fa-fw "></i>关于我</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>

      <section class="content-wra aa99">
        <!-- <div class="row">
          
    <div class="widget" style="padding:0 15px;">
        <div id="search-form" > 
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?" style="width:100%;border-radius:0;">

                
                
            </div>
            <div id="result-wrap" class="hide" style="padding:0 20px;">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>


        </div> -->
        <div class="row">
            <main class="col-md-9 main-content m-post">
                <p id="process"></p>
<article class="post pp99">
    <div class="post-head">
        <h1 id="ror-system-rails tutorial笔记">
            
	            ror-system-rails tutorial笔记
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <span>ror系统</span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            ror系统
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2018/01/30</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <p>▲▲▲测试的情景，写法对应哪一章节？——目的是在其他专案也知道怎么写测试</p>
<p>twitter的MVC关系？用devise是不是可以省略中间的章节？——目的是理清twitter最小模型，可以完成练习题</p>
<p>首页显示其他用户的动态是怎么实现？——目的是在其他专案写动态效果</p>
<h2 id="推荐课程和书籍"><a href="#推荐课程和书籍" class="headerlink" title="推荐课程和书籍"></a>推荐课程和书籍</h2><h3 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h3><p>codeschool的rspec，可以解惑很多rspec的疑问。<a href="https://www.codeschool.com/courses/testing-with-rspec" target="_blank" rel="noopener">https://www.codeschool.com/courses/testing-with-rspec</a></p>
<h3 id="第四章"><a href="#第四章" class="headerlink" title="第四章"></a>第四章</h3><p>读完本书后读一本专门针对ruby的书：《Ruby入门》、《The Well-Grounded Rubyist》、或《Ruby之道》。</p>
<h2 id="tip1、新建专案"><a href="#tip1、新建专案" class="headerlink" title="tip1、新建专案"></a>tip1、新建专案</h2><p>rails new </p>
<p>git init</p>
<p>.gitignore忽略rails应用程序文档，vim和emacs的交换文件swap file，mac finder生成的.DS_Store文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Ignore bundler config.</span><br><span class="line">/.bundle</span><br><span class="line"># Ignore the default SQLite database.</span><br><span class="line">/db/*.sqlite3</span><br><span class="line">/db/*.sqlite3-journal</span><br><span class="line"># Ignore all logfiles and tempfiles.</span><br><span class="line">/log/*.log</span><br><span class="line">/tmp</span><br><span class="line"># Ignore other unneeded files.</span><br><span class="line">doc/</span><br><span class="line">*.swp</span><br><span class="line">*~</span><br><span class="line">.project</span><br><span class="line">.DS_Store</span><br><span class="line">.idea</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle install --without production #不安装生产环境的gem</span><br></pre></td></tr></table></figure>
<p>README.md</p>
<p>2.3.5 config/environments/production.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DemoApp::Application.configure do</span><br><span class="line">  config.serve_static_assets = true</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="tip2、rails-c命令4-2、4-3"><a href="#tip2、rails-c命令4-2、4-3" class="headerlink" title="tip2、rails c命令4.2、4.3"></a>tip2、rails c命令4.2、4.3</h2><p>常用方法：length、first、last、sort、reverse、shuffle打乱、to_a/i/f/s、inspect、class、superclass</p>
<p>布尔方法：empty?，比如nil.to_s.empty?。blank?。present?。</p>
<p>转换方法：split，字符转数组。join，数组转字符。push，同&lt;&lt;，生成新数组。</p>
<p>控制流程：==、!=</p>
<p>块：each、map同collect执行并返回数组、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(0..9).to_a #Range</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = %w[foo bar baz quux] #创建一个元素为字符串的数组</span><br></pre></td></tr></table></figure>
<h2 id="tip3、rails命令"><a href="#tip3、rails命令" class="headerlink" title="tip3、rails命令"></a>tip3、rails命令</h2><p>1）删除文件。-rf意思是强制递归，无需确认就删除。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf xxx</span><br></pre></td></tr></table></figure>
<p>2）不安装生产环境的gem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle install --without production</span><br></pre></td></tr></table></figure>
<p>3）db前进</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rake db:migrate</span><br></pre></td></tr></table></figure>
<p>4）db后退</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rake db:rollback</span><br></pre></td></tr></table></figure>
<p>或是用以下命令。0是回到最开始的版本，数字对应不同版本。与rake db:rollback类似</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rake db:migrate VERSION=0</span><br></pre></td></tr></table></figure>
<p>4）不生成测试文件（暂时不建议用，因为2017rails测试改版）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails new sample_app --skip-test-unit #忽略测试文件。但是2017新版好像很好用。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate controller StaticPages home help --no-test-framework</span><br></pre></td></tr></table></figure>
<h3 id="tip4、heroku命令1-4-4"><a href="#tip4、heroku命令1-4-4" class="headerlink" title="tip4、heroku命令1.4.4"></a>tip4、heroku命令1.4.4</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">heroku login</span><br><span class="line">heroku create</span><br><span class="line">heroku open</span><br><span class="line">heroku logs</span><br><span class="line">heroku rename xxx</span><br><span class="line">git push heroku master</span><br></pre></td></tr></table></figure>
<p>heroku命令，<a href="http://devcenter.heroku.com/heroku-command" target="_blank" rel="noopener">http://devcenter.heroku.com/heroku-command</a></p>
<p>heroku自定义域名，<a href="https://devcenter.heroku.com/" target="_blank" rel="noopener">https://devcenter.heroku.com/</a></p>
<h3 id="tip5、rspec命令"><a href="#tip5、rspec命令" class="headerlink" title="tip5、rspec命令"></a>tip5、rspec命令</h3><p>1）生成测试文件的命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g integration_test xxxx</span><br></pre></td></tr></table></figure>
<h1 id="rspec情景："><a href="#rspec情景：" class="headerlink" title="rspec情景："></a>rspec情景：</h1><h2 id="1、新建页面时，测试是否正在这个页面。"><a href="#1、新建页面时，测试是否正在这个页面。" class="headerlink" title="1、新建页面时，测试是否正在这个页面。"></a>1、新建页面时，测试是否正在这个页面。</h2><p>用have_content，检测含有文字’Sample App’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">describe &quot;Static pages&quot; do</span><br><span class="line">  describe &quot;Home page&quot; do</span><br><span class="line">    it &quot;should have the content &apos;Sample App&apos;&quot; do</span><br><span class="line">      visit &apos;/static_pages/home&apos;</span><br><span class="line">      expect(page).to have_content(&apos;Sample App&apos;)</span><br><span class="line">	end </span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="2、新建页面后，测试是否包含标题。"><a href="#2、新建页面后，测试是否包含标题。" class="headerlink" title="2、新建页面后，测试是否包含标题。"></a>2、新建页面后，测试是否包含标题。</h2><p>用have_title，检测含有标题”Ruby on Rails Tutorial Sample App | Home”。并新增一个测试，不包含“| Home”。</p>
<p>1）测试代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe &quot;Static pages&quot; do</span><br><span class="line">  describe &quot;Home page&quot; do</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    it &quot;should have the title &apos;Home&apos;&quot; do</span><br><span class="line">      visit &apos;/static_pages/home&apos;</span><br><span class="line">      expect(page).to have_title(&quot;Ruby on Rails Tutorial Sample App | Home&quot;)</span><br><span class="line">	end </span><br><span class="line"></span><br><span class="line">    it &quot;should not have a custom page title&quot; do</span><br><span class="line">      visit &apos;/static_pages/home&apos;</span><br><span class="line">      expect(page).not_to have_title(&apos;| Home&apos;)</span><br><span class="line">	end	</span><br><span class="line">  end	</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>2）application.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;&lt;%= full_title(yield(:title)) %&gt;&lt;/title&gt;</span><br></pre></td></tr></table></figure>
<p>3）app/helpers/application_helper.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def full_title(page_title)</span><br><span class="line">  base_title = &quot;Ruby on Rails Tutorial Sample App&quot;</span><br><span class="line">  if page_title.empty?</span><br><span class="line">    base_title</span><br><span class="line">  else</span><br><span class="line">    &quot;#&#123;base_title&#125; | #&#123;page_title&#125;&quot;</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>4）home.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% provide(:title, &apos;Home&apos;) %&gt; #把Home赋值给title</span><br></pre></td></tr></table></figure>
<h1 id="第一章-配置"><a href="#第一章-配置" class="headerlink" title="第一章 配置"></a>第一章 配置</h1><p>环境搭建、git、github、heroku。</p>
<p>目的：了解一些命令即可，命令相关的可以归档在这一章。</p>
<h2 id="1-2-2-搭建环境"><a href="#1-2-2-搭建环境" class="headerlink" title="1.2.2 搭建环境"></a>1.2.2 搭建环境</h2><p>RubyGems的作用，一定要安装吗？一般不生成rdoc和ri文档，而是依靠在线文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install: --no-rdoc --no-ri</span><br><span class="line">update: --no-rdoc --no-ri</span><br></pre></td></tr></table></figure>
<h2 id="1-3-1-git"><a href="#1-3-1-git" class="headerlink" title="1.3.1 git"></a>1.3.1 git</h2><p>1）用git co替代git checkout</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.co checkout</span><br></pre></td></tr></table></figure>
<p>2）.gitignore设置，可以忽略mac finder产生的.DS_Store。详见tips1。</p>
<h2 id="1-3-4-github"><a href="#1-3-4-github" class="headerlink" title="1.3.4 github"></a>1.3.4 github</h2><p>1）-u的意思：将本地master分支推送到origin主机，同时指定origin主机为默认主机。后面就可以不加任何参数的使用git push、或git pull了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/&lt;username&gt;/demo_app.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>
<p>2）用git push替代git push origin master</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin master //跟踪远程分支，让本地与远程仓库关联</span><br></pre></td></tr></table></figure>
<h2 id="1-3-5-分支"><a href="#1-3-5-分支" class="headerlink" title="1.3.5 分支"></a>1.3.5 分支</h2><p>1）-a意思是添加文件的所有改动，包括对旧文件的重命名、移动等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -am &quot;xxx&quot;</span><br></pre></td></tr></table></figure>
<h1 id="第二章-脚手架"><a href="#第二章-脚手架" class="headerlink" title="第二章 脚手架"></a>第二章 脚手架</h1><p>创建脚手架（上线网站要有验证、有测试、有布局）、MVC、REST、OOP面向对象编程的继承。</p>
<p>目的：了解上线网站的需求。能用自己的话清晰描述MVC、REST、OOP。</p>
<h2 id="2-1-脚手架"><a href="#2-1-脚手架" class="headerlink" title="2.1 脚手架"></a>2.1 脚手架</h2><p>1）脚手架命令。rails会自动创建id，所以不用写id。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rails g scaffold User name:string email:string</span><br><span class="line">或</span><br><span class="line">rails g scaffold Micropost content:string user_id:integer</span><br></pre></td></tr></table></figure>
<blockquote>
<p>缺陷是：</p>
<p>①、没有数据验证、没有身份验证。——不安全。</p>
<p>②、没有自动化测试。——存在各种bug。</p>
<p>③、没有布局。——代码是重复的。</p>
</blockquote>
<h2 id="2-2-Users"><a href="#2-2-Users" class="headerlink" title="2.2 Users"></a>2.2 Users</h2><p>查看所有的rake命令，或查看所有的rake与db相关的命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rake -T</span><br><span class="line">rake -T db</span><br></pre></td></tr></table></figure>
<h2 id="2-2-2-MVC、REST"><a href="#2-2-2-MVC、REST" class="headerlink" title="2.2.2 MVC、REST"></a>2.2.2 MVC、REST</h2><p>1）mvc运作流程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def index </span><br><span class="line">  @user = User.all</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">1、点击网页浏览器发出请求</span><br><span class="line">2、通过routes找到对应的controller和action</span><br><span class="line">3、controller向model请求资料，比如User.all</span><br><span class="line">4、model从db里读取出的User.all的资料</span><br><span class="line">5、model拿到的资料回传给controller</span><br><span class="line">6、controller把拿到的数据赋值给@user变量，传递给view</span><br><span class="line">7、view文件比如index.html.erb使用ruby渲染成html</span><br><span class="line">8、controller把生成的html发送给浏览器</span><br></pre></td></tr></table></figure>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fnocpw8yz2j30dj0et0sx.jpg" width="400"></p>
<p>2）REST，是表现层状态转换。</p>
<p>把七个action对应到浏览器的四个verb。关于HTTP超文本传输协议，详见3.1章。</p>
<p>一般create、update、destroy不会渲染页面，只修改数据库中的用户数据。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fnzsq2mpsvj30cv09jdga.jpg" width="500"></p>
<h2 id="2-3-4-OOP面向对象继承"><a href="#2-3-4-OOP面向对象继承" class="headerlink" title="2.3.4 OOP面向对象继承"></a>2.3.4 OOP面向对象继承</h2><p>User和Micropost继承自ActiveRecord::Base，才能和数据库通讯。</p>
<p>UserController和MicropostController继承自ActionController::Base，能获得很多功能。比如处理模型对象、过滤http请求、将视图渲染成html等。</p>
<h2 id="2-3-5-让rails能服务于静态资源文件——不配置会怎样？？"><a href="#2-3-5-让rails能服务于静态资源文件——不配置会怎样？？" class="headerlink" title="2.3.5 让rails能服务于静态资源文件——不配置会怎样？？"></a>2.3.5 让rails能服务于静态资源文件——不配置会怎样？？</h2><p>config/environments/production.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DemoApp::Application.configure do</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  config.serve_static_assets = true</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h1 id="第三章-BDD之rspec"><a href="#第三章-BDD之rspec" class="headerlink" title="第三章 BDD之rspec"></a>第三章 BDD之rspec</h1><p>有bug，知道正确配置rspec。</p>
<p>能用自己的话描述BDD、TDD、集成测试、单元测试。</p>
<p>动态标题写法用在其他专案。</p>
<p>rspec测试效率的工具，需要google找替代品。</p>
<h2 id="3-2-1-课程bug1"><a href="#3-2-1-课程bug1" class="headerlink" title="3.2.1 课程bug1"></a>3.2.1 课程bug1</h2><p>【bug】执行以下命令后报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rspec spec/requests/static_pages_spec.rb</span><br></pre></td></tr></table></figure>
<p>报错如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">✘ apple@apple ⮀ ~/rails/sample_app ⮀ ⭠ test± ⮀ bundle exec rspec spec/requests/static_pages_spec.rb</span><br><span class="line">/Users/apple/.rvm/gems/ruby-2.3.1/gems/selenium-webdriver-2.0.0/lib/selenium/webdriver/common/zipper.rb:1:in `require&apos;: cannot load such file -- zip/zip (LoadError)</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/selenium-webdriver-2.0.0/lib/selenium/webdriver/common/zipper.rb:1:in `&lt;top (required)&gt;&apos;</span><br></pre></td></tr></table></figure>
<p>解决办法：找了以下三个解答，无效。</p>
<p><a href="http://blog.csdn.net/mydo/article/details/54345527" target="_blank" rel="noopener">http://blog.csdn.net/mydo/article/details/54345527</a></p>
<p><a href="https://ruby-china.org/topics/18548" target="_blank" rel="noopener">https://ruby-china.org/topics/18548</a></p>
<p>rspect官网问答区<a href="https://github.com/rspec/rspec-rails/issues/1273" target="_blank" rel="noopener">https://github.com/rspec/rspec-rails/issues/1273</a></p>
<p>同个例子别人的blog<a href="https://hk.saowen.com/a/63a91c9dbdc6cc6e4409e590b69dbe80ce8961e5a9aec8307c6f108ad4796204" target="_blank" rel="noopener">https://hk.saowen.com/a/63a91c9dbdc6cc6e4409e590b69dbe80ce8961e5a9aec8307c6f108ad4796204</a></p>
<p>stackoverflow<a href="https://stackoverflow.com/questions/18555992/bundle-exec-rspec-spec-requests-static-pages-spec-rb-from-hartls-tutorial-isnt" target="_blank" rel="noopener">https://stackoverflow.com/questions/18555992/bundle-exec-rspec-spec-requests-static-pages-spec-rb-from-hartls-tutorial-isnt</a></p>
<p>装上gem ‘test-unit’，和gem ‘zip’，报错如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> apple@apple ⮀ ~/rails/sample_app ⮀ ⭠ test± ⮀ bundle exec rspec spec/requests/static_pages_spec.rb</span><br><span class="line">DEPRECATION WARNING: alias_method_chain is deprecated. Please, use Module#prepend instead. From module, you can access the original method using super. (called from &lt;top (required)&gt; at /Users/apple/rails/sample_app/spec/spec_helper.rb:4)</span><br><span class="line">DEPRECATION WARNING: alias_method_chain is deprecated. Please, use Module#prepend instead. From module, you can access the original method using super. (called from &lt;top (required)&gt; at /Users/apple/rails/sample_app/spec/spec_helper.rb:4)</span><br><span class="line">/Users/apple/.rvm/gems/ruby-2.3.1/gems/rspec-rails-2.13.1/lib/rspec/rails/fixture_support.rb:19:in `block (2 levels) in &lt;module:FixtureSupport&gt;&apos;: private method `fixture_path&apos; called for #&lt;RSpec::Core::Configuration:0x007fdba70f85e0&gt; (NoMethodError)</span><br><span class="line">Did you mean?  fixture_path=</span><br><span class="line">	from /Users/apple/.rvm/gems/ruby-2.3.1/gems/rspec-rails-2.13.1/lib/rspec/rails/fixture_support.rb:17:in `class_eval&apos;</span><br></pre></td></tr></table></figure>
<h3 id="最终解决办法："><a href="#最终解决办法：" class="headerlink" title="最终解决办法："></a>最终解决办法：</h3><p>参考资料stackoverflow：<a href="https://stackoverflow.com/questions/15148585/undefined-method-visit-when-using-rspec-and-capybara-in-rails" target="_blank" rel="noopener">https://stackoverflow.com/questions/15148585/undefined-method-visit-when-using-rspec-and-capybara-in-rails</a></p>
<p>修改spec/rails_helper.rb，搞定！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">require &apos;spec_helper&apos;</span><br><span class="line">ENV[&apos;RAILS_ENV&apos;] ||= &apos;test&apos;</span><br><span class="line">require File.expand_path(&apos;../../config/environment&apos;, __FILE__)</span><br><span class="line">abort(&quot;The Rails environment is running in production mode!&quot;) if Rails.env.production?</span><br><span class="line">require &apos;rspec/rails&apos; #加入</span><br><span class="line">require &apos;capybara/rails&apos; #加入</span><br><span class="line">require &apos;capybara/rspec&apos; #加入</span><br><span class="line"></span><br><span class="line">ActiveRecord::Migration.maintain_test_schema!</span><br><span class="line">RSpec.configure do |config|</span><br><span class="line">  config.fixture_path = &quot;#&#123;::Rails.root&#125;/spec/fixtures&quot;</span><br><span class="line">  config.infer_spec_type_from_file_location!</span><br><span class="line">  config.filter_rails_from_backtrace!</span><br><span class="line">  config.include Capybara::DSL #针对这个问题，重点加入</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="怎么知道gem-capybara是否生效？"><a href="#怎么知道gem-capybara是否生效？" class="headerlink" title="怎么知道gem capybara是否生效？"></a>怎么知道gem capybara是否生效？</h3><p>新建spec/features/demo.rb，用一个demo案例来测试。</p>
<p>粘贴后执行<code>rspec spec/features/demo.rb</code>，会显示1个成功0个失败。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">require &apos;rails_helper&apos; #注意是rails_helper</span><br><span class="line"></span><br><span class="line">feature &quot;demo&quot;, :type =&gt; :feature do #注意是feature</span><br><span class="line">  scenario &quot;demo1&quot; do</span><br><span class="line">    visit &quot;/&quot;</span><br><span class="line">    expect(page).to have_content(&quot;Hello&quot;)</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="3-2-1-课程bug2"><a href="#3-2-1-课程bug2" class="headerlink" title="3.2.1 课程bug2"></a>3.2.1 课程bug2</h2><p>教材的这段代码，因为太旧不能使用，怎么改都报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">require &quot;spec_helper&quot;</span><br><span class="line">describe &quot;Static pages&quot; do</span><br><span class="line">  describe &quot;Home page&quot; do</span><br><span class="line">    it &quot;should have the content &apos;Sample App&apos;&quot; do</span><br><span class="line">      visit &apos;/static_pages/home&apos;</span><br><span class="line">      expect(page).to have_content(&apos;Sample App&apos;)</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="暂时解决办法："><a href="#暂时解决办法：" class="headerlink" title="暂时解决办法："></a>暂时解决办法：</h3><p>把<code>spec_helper</code>改成<code>rails_helper</code>。并加上<code>:type =&gt; :feature</code>。</p>
<p>本来想用<code>:type =&gt; :request</code>，但是报错，不知道怎么解决。暂时先用feature做下去吧。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">require &apos;rails_helper&apos; #注意是rails_helper</span><br><span class="line"></span><br><span class="line">describe &quot;Static pages&quot;, :type =&gt; :feature do #注意是feature</span><br><span class="line">  describe &quot;Home page&quot; do</span><br><span class="line">    it &quot;should have the content &apos;Sample App&apos;&quot; do</span><br><span class="line">      visit &quot;/static_pages/home&quot;</span><br><span class="line">      expect(page).to have_content(&quot;Sample App&quot;)</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="最终解决办法：-1"><a href="#最终解决办法：-1" class="headerlink" title="最终解决办法："></a>最终解决办法：</h3><p>按3.2.1课程bug1最终解法做。</p>
<h2 id="3-2-1-课程bug3"><a href="#3-2-1-课程bug3" class="headerlink" title="3.2.1 课程bug3"></a>3.2.1 课程bug3</h2><p>不做任何操作，直接执行<code>rake db:migrate</code>报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> apple@apple ⮀ ~/rails/sample_app ⮀ ⭠ master± ⮀ rake db:migrate</span><br><span class="line">rake aborted!</span><br><span class="line">NoMethodError: undefined method `last_comment&apos; for #&lt;Rake::Application:0x007fe240bed8c0&gt;</span><br></pre></td></tr></table></figure>
<p>解决办法：</p>
<p><a href="https://stackoverflow.com/questions/35893584/nomethoderror-undefined-method-last-comment-after-upgrading-to-rake-11" target="_blank" rel="noopener">https://stackoverflow.com/questions/35893584/nomethoderror-undefined-method-last-comment-after-upgrading-to-rake-11</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle update rspec-rails</span><br></pre></td></tr></table></figure>
<p>附：官网<a href="https://github.com/rspec/rspec-rails" target="_blank" rel="noopener">https://github.com/rspec/rspec-rails</a></p>
<h2 id="3-1-静态页面"><a href="#3-1-静态页面" class="headerlink" title="3.1 静态页面"></a>3.1 静态页面</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate controller StaticPages home help --no-test-framework</span><br></pre></td></tr></table></figure>
<p>1）驼峰式命名StaticPages，生成的控制器名是蛇底式命名static_pages_controller.rb。</p>
<p>2）HTTP超文本传输协议。</p>
<h2 id="3-2-BDD（rspec和cucumber）"><a href="#3-2-BDD（rspec和cucumber）" class="headerlink" title="3.2 BDD（rspec和cucumber）"></a>3.2 BDD（rspec和cucumber）</h2><p>TDD是什么？</p>
<p>BDD是什么？行为驱动开发，<strong>『遇红、变绿、重构』</strong>的流程。分为集成测试（integration test）和单元测试（unit test）。</p>
<p>什么是集成测试？模拟用户在浏览器的交互操作。配合capybara语法使用。</p>
<h2 id="3-6-测试效率工具，结合实战圣经"><a href="#3-6-测试效率工具，结合实战圣经" class="headerlink" title="3.6 测试效率工具，结合实战圣经"></a>3.6 测试效率工具，结合实战圣经</h2><h2 id="3-6-1-集成了bundler的RVM"><a href="#3-6-1-集成了bundler的RVM" class="headerlink" title="3.6.1 集成了bundler的RVM"></a>3.6.1 集成了bundler的RVM</h2><blockquote>
<p>作用：不用输入rspec命令前的bundle exec。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rvm -v #查看RVM版本，只要是v1.11.x以上的就可以</span><br><span class="line">rvm get stable #更新RVM</span><br></pre></td></tr></table></figure>
<p>如果更新失败，查看解决办法。</p>
<h3 id="binstubs"><a href="#binstubs" class="headerlink" title="binstubs"></a>binstubs</h3><blockquote>
<p>作用：跟3.6.1的RVM一样，如果RVM安装成功了就跳过。</p>
</blockquote>
<h2 id="3-6-2-guard"><a href="#3-6-2-guard" class="headerlink" title="3.6.2 guard"></a>3.6.2 guard</h2><blockquote>
<p>作用：执行guard后，会进入guard界面，每当rspec文件改动保存，就会在guard界面自动测试。</p>
</blockquote>
<p>1、安装gem，并bundle</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">group :development, :test do</span><br><span class="line">  gem &apos;guard-rspec&apos;, &apos;2.5.0&apos;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>2、让guard结合rspec，执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guard init rspec</span><br></pre></td></tr></table></figure>
<p>3、！！99未尝试。确保失败的测试通过后grard不会运行所有测试（为了加快遇红、变绿、重构过程）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guard &apos;rspec&apos;, all_after_pass: false do</span><br></pre></td></tr></table></figure>
<p>4、运行后，修改repec文件的代码，保存后就能在guard中看到正在自动测试。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">guard</span><br></pre></td></tr></table></figure>
<h2 id="3-6-3-Spork，gem很老有bug，先跳过"><a href="#3-6-3-Spork，gem很老有bug，先跳过" class="headerlink" title="3.6.3 Spork，gem很老有bug，先跳过"></a>3.6.3 Spork，gem很老有bug，先跳过</h2><blockquote>
<p>作用：每次测试前都要重新加载整个rails目录，速度很慢。用Spork只需加载一次。</p>
</blockquote>
<p>安装加速gem spork-rails遇到bug，看这个gem也几年没更新了。先跳过。</p>
<p>有没有其他取代的gem？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time bundle exec rspec spec/requests/static_pages_spec.rb #列出测试所用时间</span><br></pre></td></tr></table></figure>
<h2 id="3-6-4-sublime"><a href="#3-6-4-sublime" class="headerlink" title="3.6.4 sublime"></a>3.6.4 sublime</h2><p>用快捷键执行rspec。有空回头找找atom的。</p>
<h1 id="第四章-ruby知识点-数组-hash-类"><a href="#第四章-ruby知识点-数组-hash-类" class="headerlink" title="第四章 ruby知识点/数组/hash/类"></a>第四章 ruby知识点/数组/hash/类</h1><p>布局文件三行命令的解读。4.2章ruby知识点：module、注释#、局部变量赋值、布尔值boolean、流程控制if或unless、字符串插值#{xx}、返回值return。数组和hash。类的继承、类方法、类变量、类引用。</p>
<p>目的：知识点比较零碎，多看多在rails c里练。数组、hash、类方法的写法在model、controller、rails c经常用到，要练到想写什么效果就能写出来转换自如。</p>
<h2 id="4-2-ruby知识点"><a href="#4-2-ruby知识点" class="headerlink" title="4.2 ruby知识点"></a>4.2 ruby知识点</h2><h2 id="4-3-数组和hash"><a href="#4-3-数组和hash" class="headerlink" title="4.3 数组和hash"></a>4.3 数组和hash</h2><p>hash区别于数组，在于hash没有顺序。</p>
<p>hash的格式，用hashrocket即 :foo =&gt; “xx”，或用symbol即foo: “xx”。</p>
<h2 id="4-3-2-ruby语法例子"><a href="#4-3-2-ruby语法例子" class="headerlink" title="4.3.2 ruby语法例子"></a>4.3.2 ruby语法例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&apos;a&apos;..&apos;z&apos;).to_a.shuffle[0..7].join</span><br></pre></td></tr></table></figure>
<p>解读：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; (&apos;a&apos;..&apos;z&apos;).to_a #生成数组      </span><br><span class="line">=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;, &quot;k&quot;, &quot;l&quot;, &quot;m&quot;, &quot;n&quot;, &quot;o&quot;, &quot;p&quot;, &quot;q&quot;, &quot;r&quot;, &quot;s&quot;, &quot;t&quot;, &quot;u&quot;, &quot;v&quot;, &quot;w&quot;, &quot;x&quot;, &quot;y&quot;, &quot;z&quot;]</span><br><span class="line">&gt;&gt; (&apos;a&apos;..&apos;z&apos;).to_a.shuffle #打乱</span><br><span class="line">=&gt; [&quot;c&quot;, &quot;g&quot;, &quot;l&quot;, &quot;k&quot;, &quot;h&quot;, &quot;z&quot;, &quot;s&quot;, &quot;i&quot;, &quot;n&quot;, &quot;d&quot;, &quot;y&quot;, &quot;u&quot;, &quot;t&quot;, &quot;j&quot;, &quot;q&quot;, &quot;b&quot;, &quot;r&quot;, &quot;o&quot;, &quot;f&quot;, &quot;e&quot;, &quot;w&quot;, &quot;v&quot;, &quot;m&quot;, &quot;a&quot;, &quot;x&quot;, &quot;p&quot;]</span><br><span class="line">&gt;&gt; (&apos;a&apos;..&apos;z&apos;).to_a.shuffle[0..7] #前8个数据</span><br><span class="line">=&gt; [&quot;f&quot;, &quot;w&quot;, &quot;i&quot;, &quot;a&quot;, &quot;h&quot;, &quot;p&quot;, &quot;c&quot;, &quot;x&quot;]</span><br><span class="line">&gt;&gt; (&apos;a&apos;..&apos;z&apos;).to_a.shuffle[0..7].join #数组转成字符串           </span><br><span class="line">=&gt; &quot;mznpybuj&quot;</span><br></pre></td></tr></table></figure>
<h2 id="4-3-3-inspect"><a href="#4-3-3-inspect" class="headerlink" title="4.3.3 inspect"></a>4.3.3 inspect</h2><p>对比<code>puts (1..5).to_a</code>和<code>puts (1..5).to_a.inspect</code>，前者把数组作为字符串输出即输出数字。后者输出数组的字面量形式即一个阵列。</p>
<p>inspect的快捷用法是p。比如<code>p :name</code>等价于<code>puts :name.inspect</code>。</p>
<p>【问题】inspect和print效果好像差不多，两者有什么区别？</p>
<h2 id="4-3-4-布局application-rb三个命令理解"><a href="#4-3-4-布局application-rb三个命令理解" class="headerlink" title="4.3.4 布局application.rb三个命令理解"></a>4.3.4 布局application.rb三个命令理解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= stylesheet_link_tag &quot;application&quot;, media: &quot;all&quot;,</span><br><span class="line">                                           &quot;data-turbolinks-track&quot; =&gt; true %&gt;</span><br><span class="line">&lt;%= javascript_include_tag &quot;application&quot;, &quot;data-turbolinks-track&quot; =&gt; true %&gt;</span><br><span class="line">&lt;%= csrf_meta_tags %&gt;</span><br></pre></td></tr></table></figure>
<p>1）布局里的&lt;%= csrf_meta_tags %&gt;，用来防止“跨站请求伪造”。</p>
<p>2）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= stylesheet_link_tag &quot;application&quot;, media: &quot;all&quot;,</span><br><span class="line">                                       &quot;data-turbolinks-track&quot; =&gt; true %&gt;</span><br></pre></td></tr></table></figure>
<p>上边这段是下边这段的缩写。</p>
<ul>
<li>使用&lt;%= %&gt;，执行结果会通过erb即ruby语法转化成html插入模板中。</li>
</ul>
<ul>
<li>stylesheet_link_tag是rails一个特殊函数，用来引入样式表</li>
</ul>
<ul>
<li>ruby中函数的括号可以省略</li>
<li>hash最后一个参数，可以省略花括号</li>
<li>symbol符号不能用连字符-，所以要用旧语法<code>data-turbolinks-track&quot; =&gt; true</code></li>
<li>拆成两行，ruby不关心有没有换行或空格，也保持每行代码不超过80列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= stylesheet_link_tag (&quot;application&quot;, &#123; media: &quot;all&quot;,</span><br><span class="line">                                       &quot;data-turbolinks-track&quot; =&gt; true &#125;) %&gt;</span><br></pre></td></tr></table></figure>
<p>整句解读：调用stylesheet_link_tag函数，传进两个参数，一个是字符串指明样式表路径，一个是hash包含两个元素，指明媒介类型，并启用Turbolinks功能。</p>
<h2 id="4-4-1-构造器"><a href="#4-4-1-构造器" class="headerlink" title="4.4.1 构造器"></a>4.4.1 构造器</h2><p>双引号是字符串的<strong>『字面构造器』</strong>。</p>
<p>new是<strong>『具名构造器』</strong>。</p>
<p><strong>『在类上调用的方法比如new，称为类方法。调用new得到的结果是一个对象，称为类的实例。在实例上调用的方法叫实例方法，比如length』</strong>。</p>
<h2 id="4-4-2-类的继承-superclass和-class"><a href="#4-4-2-类的继承-superclass和-class" class="headerlink" title="4.4.2 类的继承.superclass和.class"></a>4.4.2 类的继承.superclass和.class</h2><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fnzzlg5ydzj306f06qjra.jpg" width="250"></p>
<h2 id="4-4-3-修改内置的类"><a href="#4-4-3-修改内置的类" class="headerlink" title="4.4.3 修改内置的类"></a>4.4.3 修改内置的类</h2><p>可以改String等类，但是少用。</p>
<p>blank?是rails为ruby添加的方法。</p>
<p>blank?、empty?、nil?的区别？bank?表示是否空白，empty?是针对字符串表示是否为空。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">2.3.1 :001 &gt; &quot;&quot;.blank?</span><br><span class="line"> =&gt; true</span><br><span class="line">2.3.1 :002 &gt; &quot;&quot;.empty?</span><br><span class="line"> =&gt; true</span><br><span class="line">2.3.1 :003 &gt; &quot;&quot;.nil?</span><br><span class="line"> =&gt; false</span><br><span class="line"> </span><br><span class="line">2.3.1 :006 &gt; &quot; &quot;.blank?</span><br><span class="line"> =&gt; true</span><br><span class="line">2.3.1 :007 &gt; &quot; &quot;.empty?</span><br><span class="line"> =&gt; false</span><br><span class="line">2.3.1 :008 &gt; &quot; &quot;.nil?</span><br><span class="line"> =&gt; false</span><br><span class="line"> </span><br><span class="line">2.3.1 :009 &gt; nil.blank?</span><br><span class="line"> =&gt; true</span><br><span class="line">2.3.1 :010 &gt; nil.empty?</span><br><span class="line">NoMethodError: undefined method `empty?&apos; for nil:NilClass</span><br><span class="line">2.3.1 :011 &gt; nil.nil?</span><br><span class="line"> =&gt; true</span><br></pre></td></tr></table></figure>
<h2 id="4-4-4-controller类"><a href="#4-4-4-controller类" class="headerlink" title="4.4.4 controller类"></a>4.4.4 controller类</h2><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fo004zhng1j307c0f7aa7.jpg" width="250"></p>
<p>rails和ruby的不同，比如没有看到类.new来定义方法，而是直接如下写出home的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class StaticPagesController &lt; ApplicationController</span><br><span class="line">  def home</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="4-4-5-用户类"><a href="#4-4-5-用户类" class="headerlink" title="4.4.5 用户类"></a>4.4.5 用户类</h2><p>example_user.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class User</span><br><span class="line">  attr_accessor :name, :email</span><br><span class="line">  def initialize(attributes = &#123;&#125;)</span><br><span class="line">    @name  = attributes[:name]</span><br><span class="line">    @email = attributes[:email]</span><br><span class="line">  end</span><br><span class="line">  def formatted_email</span><br><span class="line">    &quot;#&#123;@name&#125; &lt;#&#123;@email&#125;&gt;&quot;</span><br><span class="line">  end </span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>attr_accessor，相当于能够get读取、set修改。</p>
<p>initialize在ruby有特殊意义，当执行User.new时会执行这个方法。比如可以执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user = User.new(name: &quot;Michael Hartl&quot;, email: &quot;mhartl@example.com&quot;)</span><br></pre></td></tr></table></figure>
<p>实例变量@home，意义在于自动在视图中可用。</p>
<p>require ‘./example_user’，加载文件。</p>
<h1 id="第五章"><a href="#第五章" class="headerlink" title="第五章"></a>第五章</h1><p>partial</p>
<p>asset pipeline</p>
<p>sass</p>
<p>rspec重构</p>
<p>用户注册</p>
<h2 id="5-1-1-navbar"><a href="#5-1-1-navbar" class="headerlink" title="5.1.1 navbar"></a>5.1.1 navbar</h2><p>1）html样式bug，navbar显示有问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;nav&gt; </span><br><span class="line">  &lt;ul class=&quot;nav pull-right&quot;&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure>
<p>把代码改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul class=&quot;nav navbar-nav pull-right&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>2）【问题】html5标签，header、nav、section、div。分别用在什么区域？</p>
<p>3）link_to是rails的帮助方法，可用来创建链接。</p>
<p>4）【问题】hero-unit在bootstrap中的意义是？</p>
<p>5）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= link_to image_tag(&quot;rails.png&quot;, alt: &quot;Rails&quot;), &apos;http://rubyonrails.org/&apos; %&gt;</span><br></pre></td></tr></table></figure>
<p>image_tag帮助方法，第一个参数图片路径(app/assets/images)，第二个参数是hash可选。alt属性是图片无法加载时，针对视觉障碍人士的显示。</p>
<p>rails默认会加上alt属性，如果不指定参数会默认使用图片文件名。</p>
<h2 id="5-1-2-bootstrap和css"><a href="#5-1-2-bootstrap和css" class="headerlink" title="5.1.2 bootstrap和css"></a>5.1.2 bootstrap和css</h2><p>bootstrap使用LESS动态生成样式表，Rails默认支持Sass。用gem bootstrap-sass，把LESS转换成Sass。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;bootstrap&quot;; #引入整个bootstrap css框架</span><br></pre></td></tr></table></figure>
<h2 id="5-3-4-课程bug"><a href="#5-3-4-课程bug" class="headerlink" title="5.3.4 课程bug"></a>5.3.4 课程bug</h2><p>报错如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1) Static pages Home page</span><br><span class="line">   Failure/Error: it &#123; should have_title(full_title(&apos;&apos;)) &#125;</span><br><span class="line"></span><br><span class="line">   NoMethodError:</span><br><span class="line">     undefined method `full_title&apos; for #&lt;RSpec::ExampleGroups::StaticPages::HomePage:0x007fd6b8b72e60&gt;</span><br></pre></td></tr></table></figure>
<h3 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h3><p>在spec/support/utilities.rb里定义full_tittle后，要在spec/requests/static_pages_spec.rb里引入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require &apos;support/utilities.rb&apos;</span><br></pre></td></tr></table></figure>
<h2 id="6-1-3"><a href="#6-1-3" class="headerlink" title="6.1.3"></a>6.1.3</h2><p>rails c沙盒，所有对数据库的修改，在exit退出后会rollback还原。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails c --sandbox</span><br></pre></td></tr></table></figure>
<p>User.new(name:”99”)，然后save。==相当于User.create(name:”99”)。</p>
<h2 id="6-2-1"><a href="#6-2-1" class="headerlink" title="6.2.1"></a>6.2.1</h2><p>命令：创建“测试数据库”。即把开发数据库db/development.sqlite3中的数据模型复制到db/test.sqlite3测试数据库。</p>
<p>用在新建model后，rake db:migrate后执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rake db:migrate</span><br><span class="line">rake test:prepare</span><br></pre></td></tr></table></figure>
<h2 id="6-2-2"><a href="#6-2-2" class="headerlink" title="6.2.2"></a>6.2.2</h2><h3 id="rails-c命令"><a href="#rails-c命令" class="headerlink" title="rails c命令"></a>rails c命令</h3><p>资料验证方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.valid?</span><br></pre></td></tr></table></figure>
<p>显示错误信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.error.full_messages</span><br></pre></td></tr></table></figure>
<h3 id="测试rspec方法"><a href="#测试rspec方法" class="headerlink" title="测试rspec方法"></a>测试rspec方法</h3><p>只要对象可以响应布尔值的方法，比如<code>foo?</code>，就有一个相应的<code>be_foo</code>可以在测试时使用。</p>
<h2 id="6-2-4"><a href="#6-2-4" class="headerlink" title="6.2.4"></a>6.2.4</h2><p>rubular，正则表达式编辑器</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fnri1pexwyj30rh0hkaas.jpg" width="500"></p>
<h2 id="6-3-陌生"><a href="#6-3-陌生" class="headerlink" title="6.3 陌生"></a>6.3 陌生</h2><p>u.authenticate(“密码”)，密码正确会对应到这笔数据。</p>
<p>u.password_digest，密码的加密形式。</p>
<h2 id="7-1-1-指定环境env的命令"><a href="#7-1-1-指定环境env的命令" class="headerlink" title="7.1.1 指定环境env的命令"></a>7.1.1 指定环境env的命令</h2><p>1）指定进入test环境的rails c</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails console test</span><br></pre></td></tr></table></figure>
<p>2）指定进入production生产环境的rails s</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails server --environment production</span><br></pre></td></tr></table></figure>
<p>3）指定production生产环境的迁移migration</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rake db:migrate RAILS_ENV=production</span><br></pre></td></tr></table></figure>
<ul>
<li><p>调试。在layout/aplication.html.erb中加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= debug(params) if Rails.env.development? %&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fnrp764de6j30vv09awes.jpg" width="500"></p>
</li>
<li><p>@user = User.params[:id]中，params[:id]返回的是字符串比如”1”，find方法自动将其转换成整数。</p>
</li>
<li><p>gem ‘factory_girl_rails’改名成gem ‘factory_bot_rails’，不过旧的还能用。</p>
</li>
<li><p>用户头像gravator绑定邮箱用到MD5加密算法，可以在rails c测试，<code>Digest::MD5::hexdigest(email.downcase)</code>。</p>
</li>
</ul>
<h2 id="8-1"><a href="#8-1" class="headerlink" title="8.1"></a>8.1</h2><p>生成rspec测试文件authentication_pages_spec.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate integration_test authentication_pages</span><br></pre></td></tr></table></figure>
<h2 id="8-1-3-创建表单form-for-和-form-tag"><a href="#8-1-3-创建表单form-for-和-form-tag" class="headerlink" title="8.1.3 创建表单form_for 和 form_tag"></a>8.1.3 创建表单form_for 和 form_tag</h2><p>form_for(@user)，rails会向/users地址发送POST请求。</p>
<p>form_for(:session, url:session_path)，指明资源名称和相应的URL地址。</p>
<h2 id="8-2-1-its方法——发现不能用"><a href="#8-2-1-its方法——发现不能用" class="headerlink" title="8.2.1 its方法——发现不能用"></a>8.2.1 its方法——发现不能用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">its(:remember_token) &#123; should_not be_blank &#125;</span><br></pre></td></tr></table></figure>
<p>its测试对象是指定的属性，而it是整个测试对象。上边代码等同于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">it &#123; expect(@user.remember_token).not_to be_blank &#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-5-练习"><a href="#8-5-练习" class="headerlink" title="8.5 练习"></a>8.5 练习</h2><p>1、什么时候用 form_for 什么时候用 form_tag ？</p>
<p>有对应 Model 的时候用 form_for，没有就用 form_tag，比如搜索框一般没有对应 Model。</p>
<h3 id="2、bug——命令rspec-spec，不能检测到执行单个文件里的bug"><a href="#2、bug——命令rspec-spec，不能检测到执行单个文件里的bug" class="headerlink" title="2、bug——命令rspec spec，不能检测到执行单个文件里的bug"></a>2、bug——命令rspec spec，不能检测到执行单个文件里的bug</h3><p>——所以，测试时修改哪个文件，就执行哪个文件的测试。</p>
<h2 id="9-1"><a href="#9-1" class="headerlink" title="9.1"></a>9.1</h2><p>rails c 里的new_record?方法。检测这笔资料是否存在于数据库中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User.first.new_record?</span><br></pre></td></tr></table></figure>
<h2 id="9-2-1-bug"><a href="#9-2-1-bug" class="headerlink" title="9.2.1 bug"></a>9.2.1 bug</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failure/Error: before &#123; patch user_path(user) &#125;</span><br><span class="line">     NoMethodError:</span><br><span class="line">       undefined method `patch&apos; for #</span><br></pre></td></tr></table></figure>
<p>原因：代码<code>before { patch user_path(user) }</code>里的patch，以及其他get、put、delete，只能用在rspece的type是request的文件中。现在我用的是feature，所以报错。</p>
<p>参考资料：<a href="https://stackoverflow.com/questions/18289463/undefined-method-patch-for-rspeccore-rails-tutorial-chapter-9" target="_blank" rel="noopener">https://stackoverflow.com/questions/18289463/undefined-method-patch-for-rspeccore-rails-tutorial-chapter-9</a></p>
<h2 id="9-5-命令"><a href="#9-5-命令" class="headerlink" title="9.5 命令"></a>9.5 命令</h2><h3 id="rake"><a href="#rake" class="headerlink" title="rake"></a>rake</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rake db:reset</span><br><span class="line">rake db:populate //在lib/task的rake文件中定义的</span><br><span class="line">bin/rails db:migrate RAILS_ENV=test</span><br></pre></td></tr></table></figure>
<h3 id="heroku"><a href="#heroku" class="headerlink" title="heroku"></a>heroku</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git push heroku</span><br><span class="line">$ heroku pg:reset DATABASE</span><br><span class="line">$ heroku rake db:migrate</span><br><span class="line">$ heroku rake db:populate</span><br><span class="line">$ heroku restart</span><br></pre></td></tr></table></figure>
<h2 id="10-1-3-课程bug"><a href="#10-1-3-课程bug" class="headerlink" title="10.1.3 课程bug"></a>10.1.3 课程bug</h2><h3 id="bug：rails-tutorial-Chapter-10-undefined-method-its’-for-RSpec"><a href="#bug：rails-tutorial-Chapter-10-undefined-method-its’-for-RSpec" class="headerlink" title="bug：rails tutorial Chapter 10  undefined method `its’ for RSpec"></a>bug：rails tutorial Chapter 10  undefined method `its’ for RSpec</h3><h3 id="解决办法：-1"><a href="#解决办法：-1" class="headerlink" title="解决办法："></a>解决办法：</h3><p>新版本的rspec不支持its语法，要安装这个gem才能使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem &apos;rspec-its&apos;</span><br></pre></td></tr></table></figure>
<p>参考资料：<a href="https://stackoverflow.com/questions/28014000/undefined-method-its-for-rspec-hartls-ruby-on-rails-tutorial" target="_blank" rel="noopener">https://stackoverflow.com/questions/28014000/undefined-method-its-for-rspec-hartls-ruby-on-rails-tutorial</a></p>
<h2 id="10-1-4"><a href="#10-1-4" class="headerlink" title="10.1.4"></a>10.1.4</h2><p>User.where(1)，没有查询到会返回nil。</p>
<p>User.find_by(1)，跟where一样，没有查询到会返回nil。</p>
<p>User.find(1)，没有查询到会bug报错。类似于!方法。</p>
<h2 id="10-2-2-课程bug"><a href="#10-2-2-课程bug" class="headerlink" title="10.2.2 课程bug"></a>10.2.2 课程bug</h2><h3 id="bug-rails-tutorial-chapter10-ArgumentError-wrong-number-of-arguments-given-1-expected-0"><a href="#bug-rails-tutorial-chapter10-ArgumentError-wrong-number-of-arguments-given-1-expected-0" class="headerlink" title="bug: rails tutorial chapter10 ArgumentError: wrong number of arguments (given 1, expected 0)"></a>bug: rails tutorial chapter10 ArgumentError: wrong number of arguments (given 1, expected 0)</h3><h3 id="解决办法：-2"><a href="#解决办法：-2" class="headerlink" title="解决办法："></a>解决办法：</h3><p>打开lib/tasks/sample_data.rake，把<code>users = User.all.limit(6)</code>改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">users = User.limit(6)</span><br></pre></td></tr></table></figure>
<p>参考资料：<a href="https://stackoverflow.com/questions/23749612/wrong-number-of-arguments-1-for-0-hartl-chapter-10-bundle-exec-rake-dbpopul" target="_blank" rel="noopener">https://stackoverflow.com/questions/23749612/wrong-number-of-arguments-1-for-0-hartl-chapter-10-bundle-exec-rake-dbpopul</a></p>
<h2 id="10-3-2-课程bug，同上新文件要引入共用文件"><a href="#10-3-2-课程bug，同上新文件要引入共用文件" class="headerlink" title="10.3.2 课程bug，同上新文件要引入共用文件"></a>10.3.2 课程bug，同上新文件要引入共用文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Failure/Error: before &#123; sign_in user &#125;</span><br><span class="line"></span><br><span class="line">     NoMethodError:</span><br><span class="line">       undefined method `sign_in&apos; for #&lt;RSpec::ExampleGroups::MicropostPages::MicropostCreation::WithValidInformation:0x007fb44e1acea8&gt;</span><br></pre></td></tr></table></figure>
<h3 id="解决办法：-3"><a href="#解决办法：-3" class="headerlink" title="解决办法："></a>解决办法：</h3><p>spec/requests/micropost_pages_spec.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require &apos;support/utilities.rb&apos;</span><br></pre></td></tr></table></figure>
<h2 id="10-3-3-课程bug"><a href="#10-3-3-课程bug" class="headerlink" title="10.3.3 课程bug"></a>10.3.3 课程bug</h2><p>bug：执行<code>rspec spec/models/user_spec.rb</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">An error occurred while loading ./spec/models/user_spec.rb.</span><br><span class="line">Failure/Error: load file</span><br><span class="line"></span><br><span class="line">SyntaxError:</span><br><span class="line">  /Users/apple/rails/sys-sample_app/spec/models/user_spec.rb:138: syntax error, unexpected tIDENTIFIER, expecting keyword_end</span><br><span class="line">      its(:feed) &#123; should include(newe...</span><br><span class="line">  ...                               ^</span><br><span class="line">  /Users/apple/rails/sys-sample_app/spec/models/user_spec.rb:138: syntax error, unexpected tIDENTIFIER, expecting keyword_end</span><br><span class="line">      its(:feed) &#123; should include(olde...</span><br><span class="line">  ...                               ^</span><br><span class="line">  /Users/apple/rails/sys-sample_app/spec/models/user_spec.rb:138: syntax error, unexpected tIDENTIFIER, expecting keyword_end</span><br><span class="line">      its(:feed) &#123; should_not include(...</span><br></pre></td></tr></table></figure>
<h3 id="解决办法：-4"><a href="#解决办法：-4" class="headerlink" title="解决办法："></a>解决办法：</h3><p>把测试从以下块中移出来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">describe &quot;micropost associations&quot; do</span><br><span class="line">  ...</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>然后单独作为一个块。重新执行<code>rspec spec/models/user_spec.rb</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">describe &quot;status&quot; do</span><br><span class="line">  before &#123; @user.save &#125;</span><br><span class="line">  let!(:older_micropost) do</span><br><span class="line">    FactoryGirl.create(:micropost, user: @user, created_at: 1.day.ago)</span><br><span class="line">  end</span><br><span class="line">  let!(:newer_micropost) do</span><br><span class="line">    FactoryGirl.create(:micropost, user: @user, created_at: 1.hour.ago)</span><br><span class="line">  end</span><br><span class="line">  let(:unfollowed_post) do</span><br><span class="line">    FactoryGirl.create(:micropost, user: FactoryGirl.create(:user))</span><br><span class="line">  end</span><br><span class="line">  its(:feed) &#123; should include(newer_micropost) &#125;</span><br><span class="line">  its(:feed) &#123; should include(older_micropost) &#125;</span><br><span class="line">  its(:feed) &#123; should_not include(unfollowed_post) &#125;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="11-2-5课程bug"><a href="#11-2-5课程bug" class="headerlink" title="11.2.5课程bug"></a>11.2.5课程bug</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Failures:</span><br><span class="line"></span><br><span class="line">  1) RelationshipsController creating a relationship with Ajax should increment the Relationship count</span><br><span class="line">     Failure/Error: cookies[:remember_token] = remember_token user.update_attribute(:remember_token, User.encrypt(remember_token))</span><br><span class="line"></span><br><span class="line">     NoMethodError:</span><br><span class="line">       undefined method `remember_token&apos; for #&lt;RSpec::ExampleGroups::RelationshipsController::CreatingARelationshipWithAjax:0x007f836346bcf0&gt;</span><br><span class="line">     # ./spec/support/utilities.rb:29:in `sign_in&apos;</span><br><span class="line">     # ./spec/controllers/relationships_controller_spec.rb:7:in `block (2 levels) in &lt;top (required)&gt;&apos;</span><br></pre></td></tr></table></figure>
<h3 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h3><p>跟上边的教材一样，没有require引入共用文件。</p>
<h3 id="解决办法：-5"><a href="#解决办法：-5" class="headerlink" title="解决办法："></a>解决办法：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">by 99</a>
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/posts/72ed4d05/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/posts/47bfe85d/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMzE1My85NzEx">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>


            </main>
            
    <aside class="col-md-3 sidebar">
        
        
    <div class="widget">
        <h3 class="title">搜索</h3>
        <div id="search-form">
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?">
                    <button type="button" class="search-form-submit" id="search-local">搜索</button>
                
                
            </div>
            <div id="result-wrap" class="hide">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>


        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>你好，我是99。<br/>欢迎来到我的博客。<br/>
<br/>
<hr/>接受贡献，包括不限于提交问题与需求，修复代码。欢迎Pull Request<br/>支持主题：<a href="https://github.com/shenliyang/hexo-theme-snippet/stargazers">Star一下</a>
</p>
        </div>
    </div>

        
        
    <div class="widget">
      <h3 class="title">社交</h3> 
        <div class="content social">
            
	            <a href="https://github.com/jiujiubad?tab=repositories" rel="external nofollow" title="Github" target="_blank">
			    	<i class="github fa fa-github"></i>
			    </a>
            
	            <a href="jiujiubad@gmail.com" rel="external nofollow" title="邮箱" target="_blank">
			    	<i class="envelope-o fa fa-envelope-o"></i>
			    </a>
            
	            <a href="https://ws4.sinaimg.cn/large/006tNc79ly1fnvcxiavzgj30by0bymxg.jpg" rel="external nofollow" title="微信" target="_blank">
			    	<i class="weixin fa fa-weixin"></i>
			    </a>
            
        </div>
    </div>


        
        
    <div class="widget">
        <h3 class="title">分类</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ror功能/"><i class="fa" aria-hidden="true">ror功能</i></a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ror知识点/"><i class="fa" aria-hidden="true">ror知识点</i></a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ror系统/"><i class="fa" aria-hidden="true">ror系统</i></a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web页面/"><i class="fa" aria-hidden="true">web页面</i></a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/"><i class="fa" aria-hidden="true">工具</i></a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/微信小程序/"><i class="fa" aria-hidden="true">微信小程序</i></a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link current" href="/categories/心得/"><i class="fa" aria-hidden="true">心得</i></a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/投资/"><i class="fa" aria-hidden="true">投资</i></a><span class="category-list-count">1</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">归档</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/"><i class="fa" aria-hidden="true">February 2018</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/"><i class="fa" aria-hidden="true">January 2018</i></a><span class="archive-list-count">37</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/"><i class="fa" aria-hidden="true">December 2017</i></a><span class="archive-list-count">35</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/"><i class="fa" aria-hidden="true">November 2017</i></a><span class="archive-list-count">36</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/"><i class="fa" aria-hidden="true">September 2017</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/"><i class="fa" aria-hidden="true">April 2017</i></a><span class="archive-list-count">1</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">标签云</h3>
    <div class="content tag-cloud">
        <a href="/tags/atom/" style="font-size: 13.64px;">atom</a> <a href="/tags/bug/" style="font-size: 19.09px;">bug</a> <a href="/tags/heroku/" style="font-size: 10px;">heroku</a> <a href="/tags/hexo/" style="font-size: 11.82px;">hexo</a> <a href="/tags/interview/" style="font-size: 12.73px;">interview</a> <a href="/tags/mac/" style="font-size: 11.82px;">mac</a> <a href="/tags/orid-day/" style="font-size: 10px;">orid-day</a> <a href="/tags/orid-month/" style="font-size: 11.82px;">orid-month</a> <a href="/tags/ror功能/" style="font-size: 13.64px;">ror功能</a> <a href="/tags/ror知识点/" style="font-size: 17.27px;">ror知识点</a> <a href="/tags/ror系统/" style="font-size: 20px;">ror系统</a> <a href="/tags/stackoverflow/" style="font-size: 10px;">stackoverflow</a> <a href="/tags/typora/" style="font-size: 10px;">typora</a> <a href="/tags/vps/" style="font-size: 16.36px;">vps</a> <a href="/tags/web页面/" style="font-size: 11.82px;">web页面</a> <a href="/tags/下载/" style="font-size: 10px;">下载</a> <a href="/tags/工具/" style="font-size: 20px;">工具</a> <a href="/tags/常用/" style="font-size: 13.64px;">常用</a> <a href="/tags/微信功能/" style="font-size: 12.73px;">微信功能</a> <a href="/tags/微信系统/" style="font-size: 15.45px;">微信系统</a> <a href="/tags/微信页面/" style="font-size: 10.91px;">微信页面</a> <a href="/tags/心得/" style="font-size: 18.18px;">心得</a> <a href="/tags/手机/" style="font-size: 10px;">手机</a> <a href="/tags/投资/" style="font-size: 10px;">投资</a> <a href="/tags/搬砖/" style="font-size: 10px;">搬砖</a> <a href="/tags/核聚编程/" style="font-size: 14.55px;">核聚编程</a> <a href="/tags/科学上网/" style="font-size: 13.64px;">科学上网</a> <a href="/tags/部署/" style="font-size: 12.73px;">部署</a>
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">友链</h3>
        <div class="content friends-link">
        
            <a href="http://www.shenliyang.com" class="fa" target="_blank">个人博客</a>
        
        </div>
    </div>


        
    </aside>


        </div>
      </section>
    </div>
  </div>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <span>Copyright &copy; 2018
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



	<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
